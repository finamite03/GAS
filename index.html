 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script> 
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

:root {
    --primary-color: #0A84FF;
    --secondary-color: #0066CC;
    --success-color: #30D158;
    --error-color: #FF453A;
    --warning-color: #FF9F0A;
    --background-color: #F5F5F7;
    --card-bg: #FFFFFF;
    --text-color: #1C2526;
    --secondary-text: #6E6E73;
    --border-color: #D6D6DB;
    --shadow-color: rgba(0, 0, 0, 0.1);
    --sidebar-width: 280px;
    --header-height: 60px;
    --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    --modal-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    --gradient-primary: linear-gradient(135deg, #0A84FF, #0066CC);
    --gradient-success: linear-gradient(135deg, #30D158, #28A745);
    --gradient-error: linear-gradient(135deg, #FF453A, #D32F2F);
    --gradient-warning: linear-gradient(135deg, #FF9F0A, #F57C00);
}

body {
    background: var(--background-color);
    color: var(--text-color);
    font-size: 16px;
    line-height: 1.6;
    letter-spacing: -0.015em;
    overflow-x: hidden;
}

h1 {
    font-size: 30px;
    font-weight: 700;
    letter-spacing: -0.03em;
}

h2 {
    font-size: 22px;
    font-weight: 600;
}

h3 {
    font-size: 17px;
    font-weight: 500;
}

.sidebar {
    position: fixed;
    width: var(--sidebar-width);
    height: 100vh;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(12px);
    border-right: 1px solid var(--border-color);
    transition: width 0.4s cubic-bezier(0.36, 0, 0.66, 0);
    box-shadow: 0 2px 10px var(--shadow-color);
}

.sidebar.collapsed {
    width: 72px;
}

.main-content {
    margin-left: var(--sidebar-width);
    padding: 32px;
    min-height: 100vh;
    transition: margin-left 0.4s cubic-bezier(0.36, 0, 0.66, 0);
}

.main-content.collapsed {
    margin-left: 72px;
}

.sidebar-header {
    height: var(--header-height);
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(245, 245, 247, 0.98));
}

.logo {
    font-size: 22px;
    font-weight: 700;
    color: var(--text-color);
    transition: opacity 0.3s;
}

.sidebar.collapsed .logo {
    opacity: 0;
}

.nav-menu {
    padding: 16px 0;
}

.nav-item {
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 14px;
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 10px;
    margin: 0 12px;
    position: relative;
}

.nav-item:hover {
    background: rgba(10, 132, 255, 0.12);
    transform: translateX(4px);
}

.nav-item.active {
    background: rgba(10, 132, 255, 0.18);
    color: var(--primary-color);
    font-weight: 600;
}

.nav-item i {
    font-size: 20px;
    width: 28px;
    text-align: center;
    color: inherit;
}

.nav-item .nav-text {
    font-size: 15px;
    font-weight: 500;
}

.sidebar.collapsed .nav-text {
    display: none;
}

/* Main Content */
.main-content {
    margin-left: var(--sidebar-width);
    padding: 32px;
    min-height: 100vh;
    transition: margin-left 0.4s cubic-bezier(0.36, 0, 0.66, 0);
}

.main-content.collapsed {
    margin-left: 72px;
}

/* Section Toggling */
.section {
    display: none; /* Hide all sections by default */
    animation: sectionFadeIn 0.5s ease-out;
}

.section.active {
    display: block; /* Show only the active section */
}

@keyframes sectionFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
    flex-wrap: wrap;
    gap: 16px;
}

.dashboard-header h1 {
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--text-color);
}

.dashboard-header h1 i {
    color: var(--primary-color);
    font-size: 24px;
}

.date-controls {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    background: var(--card-bg);
    padding: 14px;
    border-radius: 14px;
    box-shadow: var(--card-shadow);
}

.input-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.input-label {
    font-size: 15px;
    font-weight: 500;
    color: var(--secondary-text);
    display: flex;
    align-items: center;
    gap: 8px;
}

.date-input {
    padding: 10px 14px;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 15px;
    background: #F8F8FA;
    transition: border-color 0.25s, box-shadow 0.25s;
}

.date-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    outline: none;
}

/* Dashboard Cards */
.dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
}

.card {
    background: var(--card-bg);
    border-radius: 18px;
    padding: 24px;
    box-shadow: var(--card-shadow);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s;
    display: flex;
    align-items: center;
    gap: 18px;
    position: relative;
    animation: cardFadeIn 0.5s ease-out;
}

.card:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.card-icon {
    font-size: 28px;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--gradient-primary);
    color: white;
    border-radius: 14px;
    box-shadow: inset 0 -2px 4px rgba(0, 0, 0, 0.1);
}

.card:nth-child(2) .card-icon { background: var(--gradient-success); }
.card:nth-child(3) .card-icon { background: var(--gradient-error); }
.card:nth-child(4) .card-icon { background: var(--gradient-warning); }
.card:nth-child(5) .card-icon { background: linear-gradient(135deg, #5856D6, #4B4AD8); }

.card-content h3 {
    font-size: 15px;
    font-weight: 500;
    color: var(--secondary-text);
    margin-bottom: 6px;
}

.card-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--text-color);
}

@keyframes cardFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Charts */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
}

.chart-container {
    background: var(--card-bg);
    border-radius: 14px;
    box-shadow: var(--card-shadow);
    padding: 24px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.5);
}

.chart-container canvas {
    max-height: 300px;
    width: 100%;
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border-color);
}

.chart-header h2 {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.chart-header h2 i {
    color: var(--primary-color);
    font-size: 20px;
}

.chart-actions {
    display: flex;
    gap: 10px;
}

.btn-chart-action {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #F8F8FA;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    cursor: pointer;
    color: var(--secondary-text);
    transition: all 0.25s;
}

.btn-chart-action:hover {
    background: rgba(10, 132, 255, 0.12);
    color: var(--primary-color);
    transform: scale(1.05);
}

/* Tables */
.table-container {
    background: var(--card-bg);
    border-radius: 14px;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border-color);
    overflow-y: auto;
    max-height: 80vh;
}

.inventory-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: var(--card-bg);
    border-radius: 14px;
    overflow: hidden;
}

.inventory-table th,
.inventory-table td {
    padding: 14px 18px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

.inventory-table th {
    background: linear-gradient(180deg, #F8F8FA, #F5F5F7);
    font-weight: 600;
    color: var(--secondary-text);
    position: sticky;
    top: 0;
    z-index: 1;
    cursor: pointer;
}

.inventory-table tbody tr:nth-child(even) {
    background: #FAFAFC;
}

.inventory-table tbody tr:hover {
    background: rgba(10, 132, 255, 0.08);
}

.inventory-table th.sort-asc::after,
.inventory-table th.sort-desc::after {
    font-size: 13px;
    margin-left: 10px;
}

/* Buttons */
.btn {
    padding: 12px 24px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.btn-primary {
    background: var(--gradient-primary);
    color: white;
    box-shadow: inset 0 -2px 4px rgba(0, 0, 0, 0.1), 0 2px 8px var(--shadow-color);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
}

.btn-primary:focus {
    outline: 3px solid rgba(10, 132, 255, 0.3);
    outline-offset: 2px;
}

.btn-primary:active {
    transform: scale(0.98);
}

.btn-secondary {
    background: #F8F8FA;
    color: var(--text-color);
    border: 1px solid var(--border-color);
    box-shadow: inset 0 -1px 2px rgba(0, 0, 0, 0.05);
}

.btn-secondary:hover {
    background: #ECECF1;
    transform: translateY(-2px);
}

.edit-btn {
    background: #F8F8FA;
    color: var(--primary-color);
    padding: 8px 14px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    transition: all 0.25s;
}

.edit-btn:hover {
    background: rgba(10, 132, 255, 0.12);
    transform: scale(1.05);
}

/* Modals */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal.show {
    display: flex;
    opacity: 1;
}

.form-horizontal .form-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 16px;
}

.form-horizontal .form-group label {
    flex: 1;
    margin-right: 16px;
    text-align: right;
}

.form-horizontal .form-group input,
.form-horizontal .form-group select {
    flex: 2;
}

/* Ensure the grid layout works properly */
.grid {
    display: grid;
}

.grid-cols-1 {
    grid-template-columns: 1fr;
}

.grid-cols-2 {
    grid-template-columns: repeat(2, 1fr);
}

.gap-4 {
    gap: 1rem;
}
.close {
    color: var(--secondary-text);
    float: right;
    font-size: 28px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.25s;
}

.close:hover {
    color: var(--text-color);
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--text-color);
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 16px;
    background: #F8F8FA;
    transition: border-color 0.25s, box-shadow 0.25s;
}

.form-group input:focus,
.form-group select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    outline: none;
}

/* Search and Filters */
.search-filter-container {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-bottom: 28px;
    padding: 18px;
    background: var(--card-bg);
    border-radius: 14px;
    box-shadow: var(--card-shadow);
}

.search-box {
    flex: 1;
    min-width: 220px;
}

.search-box input {
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid var(--border-color);
    width: 100%;
    background: #F8F8FA;
    transition: all 0.25s;
}

.search-box input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
}

.filter-box {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 200px;
}

/* Action Buttons */
.action-buttons {
    margin-bottom: 28px;
    display: flex;
    justify-content: flex-end;
    gap: 14px;
}

/* Recent Activity */
.recent-activity {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 24px;
    box-shadow: var(--card-shadow);
    max-height: 420px;
    overflow-y: auto;
}

.recent-activity h2 {
    margin-bottom: 18px;
    font-size: 18px;
    font-weight: 600;
}

.activity-item {
    padding: 14px 0;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.25s;
}

.activity-item:hover {
    background: rgba(10, 132, 255, 0.05);
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-item strong {
    font-weight: 600;
}

.activity-item .timestamp {
    font-size: 13px;
    color: var(--secondary-text);
}

/* Alert Table */
.alert-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: var(--card-bg);
    border-radius: 14px;
    overflow: hidden;
}

.alert-table th,
.alert-table td {
    padding: 14px 18px;
    border-bottom: 1px solid var(--border-color);
}

.alert-table th {
    background: linear-gradient(180deg, #F8F8FA, #F5F5F7);
    font-weight: 600;
    color: var(--secondary-text);
    cursor: pointer;
}

.alert-table tbody tr:hover {
    background: rgba(10, 132, 255, 0.08);
}

.low-stock .stock-level {
    color: var(--error-color);
    font-weight: 700;
}

.status-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 14px;
    font-size: 13px;
    font-weight: 600;
}

.status-normal {
    background: #E6F4EA;
    color: #087F5B;
}

.status-warning {
    background: #FFF4E5;
    color: #8C6D1F;
}

.status-danger {
    background: #FEE2E2;
    color: #842029;
}

/* Export Buttons */
.export-buttons {
    display: flex;
    gap: 14px;
}

/* SweetAlert2 Customization */
.swal2-popup {
    border-radius: 20px !important;
    background: var(--card-bg) !important;
    box-shadow: var(--modal-shadow) !important;
    padding: 24px !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    backdrop-filter: blur(8px) !important;
}

.swal2-title {
    color: var(--text-color) !important;
    font-size: 22px !important;
    font-weight: 700 !important;
    margin-bottom: 12px !important;
}

.swal2-html-container {
    color: var(--secondary-text) !important;
    font-size: 16px !important;
    line-height: 1.6 !important;
}

.swal2-confirm,
.swal2-cancel {
    border-radius: 12px !important;
    padding: 12px 24px !important;
    font-weight: 600 !important;
    font-size: 16px !important;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.swal2-confirm {
    background: var(--gradient-primary) !important;
    color: white !important;
    box-shadow: inset 0 -2px 4px rgba(0, 0, 0, 0.1) !important;
}

.swal2-confirm:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3) !important;
}

.swal2-cancel {
    background: #F8F8FA !important;
    color: var(--text-color) !important;
    border: 1px solid var(--border-color) !important;
}

.swal2-cancel:hover {
    background: #ECECF1 !important;
    transform: translateY(-2px) !important;
}

.swal2-icon {
    border: none !important;
}

.swal2-success .swal2-icon-content {
    color: var(--success-color) !important;
}

.swal2-error .swal2-icon-content {
    color: var(--error-color) !important;
}

.swal2-warning .swal2-icon-content {
    color: var(--warning-color) !important;
}

.swal2-actions {
    margin-top: 20px !important;
    gap: 12px !important;
}

.swal2-timer-progress-bar {
    background: var(--primary-color) !important;
}



/* Responsive Design */
@media (max-width: 768px) {
    .sidebar {
        width: 72px;
    }

    .main-content {
        margin-left: 72px;
        padding: 20px;
    }

    .dashboard-cards {
        grid-template-columns: 1fr;
    }

    .charts-grid {
        grid-template-columns: 1fr;
    }

    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .search-filter-container {
        flex-direction: column;
    }

    .modal-content {
        width: 95%;
        padding: 20px;
    }

    .swal2-popup {
        width: 90% !important;
        padding: 20px !important;
    }
}

@media (max-width: 480px) {
    h1 {
        font-size: 26px;
    }

    h2 {
        font-size: 20px;
    }

    .card {
        padding: 18px;
    }

    .card-value {
        font-size: 28px;
    }

    .btn {
        padding: 10px 18px;
        font-size: 15px;
    }
}
</style>

<style>/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal.show {
    display: flex;
    opacity: 1;
}

.modal-content {
    background: var(--card-bg);
    padding: 5%;
    border-radius: 20px;
    width: 90%;
    height: 90%;
    max-width: 640px;
    overflow-y: auto;
    box-shadow: var(--modal-shadow);
    transform: scale(0.85);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-content.show {
    transform: scale(1);
}

/* Form Group Styles */
.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--text-color);
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid var(--border-color);
    border-radius: 10px;
    font-size: 16px;
    background: #F8F8FA;
    transition: border-color 0.25s, box-shadow 0.25s;
}

.form-group input:focus,
.form-group select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    outline: none;
}

/* Grid Layout for Form */
.grid {
    display: grid;
}

.grid-cols-2 {
    grid-template-columns: repeat(2, 1fr);
}

.gap-4 {
    gap: 1rem;
}

.col-span-2 {
    grid-column: span 2;
}

/* Ensure labels and inputs align properly */
.form-group label {
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-group input,
.form-group select {
    flex: 1;
}</style>

   
</head>

<body>
    <!-- Sidebar -->
<div id="sidebar" class="fixed h-full bg-white border-r border-gray-200 sidebar-transition w-64 z-10">
    <div class="flex items-center justify-between px-6 h-16 border-b border-gray-200">
        <span id="logo" class="text-xl font-bold text-indigo-600">IMS</span>
        <button id="toggleSidebar" class="p-2 rounded-lg hover:bg-gray-100">
            <i class="fas fa-bars text-gray-600"></i>
        </button>
    </div>
    <nav class="flex-1 px-4 py-4 space-y-2">
        <button data-section="dashboard" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('dashboard')">
            <i class="fas fa-chart-line w-5 h-5"></i>
            <span class="sidebar-text">Dashboard</span>
        </button>
        <button data-section="skuMaster" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('skuMaster')">
            <i class="fas fa-box w-5 h-5"></i>
            <span class="sidebar-text">SKU Master</span>
        </button>
        <button data-section="transactions" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('transactions')">
            <i class="fas fa-exchange-alt w-5 h-5"></i>
            <span class="sidebar-text">Transactions</span>
        </button>
        <button data-section="suppliers" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('suppliers')">
            <i class="fas fa-truck w-5 h-5"></i>
            <span class="sidebar-text">Suppliers</span>
        </button>
        <button data-section="warehousesection" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('warehousesection')">
            <i class="fas fa-building w-5 h-5"></i>
            <span class="sidebar-text">Warehouses</span>
        </button>
        <button data-section="skuVendorMapping" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('skuVendorMapping')">
            <i class="fas fa-link w-5 h-5"></i>
            <span class="sidebar-text">SKU to Vendor Mapping</span>
        </button>
        <button data-section="reports" class="nav-item flex items-center space-x-3 w-full px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-50" onclick="showSection('reports')">
            <i class="fas fa-chart-pie w-5 h-5"></i>
            <span class="sidebar-text">Reports</span>
        </button>
    </nav>
</div>

<!-- ********** Main Content ***********-->
<div class="main-content">

<div id="dashboard" class="section active">
    <div class="dashboard-header">
        <h1><i class="fas fa-chart-line"></i> Inventory Dashboard</h1>
        <div class="date-controls">
            <div class="input-group">
                <span class="input-label"><i class="far fa-calendar-alt"></i> From:</span>
                <input type="date" id="startDate" class="date-input">
            </div>
            <div class="input-group">
                <span class="input-label"><i class="far fa-calendar-alt"></i> To:</span>
                <input type="date" id="endDate" class="date-input">
            </div>
            <button class="btn btn-primary" onclick="updateDashboard()">
                <i class="fas fa-sync-alt"></i> Update
            </button>
            <button class="btn btn-secondary" onclick="resetFilters()">
                <i class="fas fa-undo"></i> Reset
            </button>
        </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
        <!-- Total SKUs -->
        <div class="bg-white rounded-lg shadow-md p-6 transition-transform hover:scale-105 flex items-center relative">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Total SKUs</h3>
                <p class="text-3xl font-bold text-indigo-600 mt-2" id="totalSKUs">0</p>
            </div>
            <div class="absolute top-4 right-4 rounded-full bg-blue-100 p-3 text-blue-600">
                <i class="fas fa-boxes"></i>
            </div>
        </div>
        <!-- Transactions -->
        <div class="bg-white rounded-lg shadow-md p-6 transition-transform hover:scale-105 flex items-center relative">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Transactions</h3>
                <p class="text-3xl font-bold text-indigo-600 mt-2" id="totalTransactions">0</p>
            </div>
            <div class="absolute top-4 right-4 rounded-full bg-indigo-100 p-3 text-indigo-600">
                <i class="fas fa-exchange-alt"></i>
            </div>
        </div>
        <!-- Vendors -->
        <div class="bg-white rounded-lg shadow-md p-6 transition-transform hover:scale-105 flex items-center relative">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Vendors</h3>
                <p class="text-3xl font-bold text-red-600 mt-2" id="totalVendors">0</p>
            </div>
            <div class="absolute top-4 right-4 rounded-full bg-red-100 p-3 text-red-600">
                <i class="fas fa-truck-loading"></i>
            </div>
        </div>
        <!-- Warehouses -->
        <div class="bg-white rounded-lg shadow-md p-6 transition-transform hover:scale-105 flex items-center relative">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Warehouses</h3>
                <p class="text-3xl font-bold text-yellow-500 mt-2" id="totalWarehouses">0</p>
            </div>
            <div class="absolute top-4 right-4 rounded-full bg-yellow-100 p-3 text-yellow-600">
                <i class="fas fa-warehouse"></i>
            </div>
        </div>
        <!-- Inventory Value -->
        <div class="bg-white rounded-lg shadow-md p-6 transition-transform hover:scale-105 flex items-center relative">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Inventory Value</h3>
                <p class="text-3xl font-bold text-purple-600 mt-2" id="inventoryValuation">0</p>
            </div>
            <div class="absolute top-4 right-4 rounded-full bg-purple-100 p-3 text-purple-600">
                <i class="fas fa-dollar-sign"></i>
            </div>
        </div>
    </div>
   
<div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
  <!-- LEFT: 4 Charts in 2x2 grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 xl:col-span-2">
    <!-- Transactions by Type -->
    <div class="bg-white rounded-lg shadow-md p-4">
      <h3 class="text-lg font-semibold text-gray-700 mb-4"><i class="fas fa-chart-bar mr-2"></i> Transactions by Type</h3>
      <canvas id="transactionsByTypeChart" width="400" height="200"></canvas>
    </div>
    <!-- Inventory by Warehouse -->
    <div class="bg-white rounded-lg shadow-md p-4">
      <h2 class="text-lg font-semibold text-gray-700 mb-2"><i class="fas fa-warehouse mr-2"></i> Inventory by Warehouse</h2>
      <canvas id="inventoryByWarehouseChart" width="400" height="200"></canvas>
    </div>
  </div>
  <!-- Recent Activities Section -->
  <div class="recent-activity bg-white rounded-lg shadow-md p-4">
    <h2 class="text-lg font-semibold mb-2"><i class="fas fa-history mr-2"></i> Recent Activities</h2>
    <div id="recentActivities" class="flex-1 overflow-y-auto space-y-2 p-2 bg-gray-100 rounded shadow" style="max-height: 300px;">
      <!-- Activities will be populated here -->
    </div>
  </div>
</div>

    <!-- Growth Chart Variations -->
    <div class="mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-chart-line mr-2"></i> Inventory Growth Visualizations</h2>
        <div class="grid grid-cols-1 md">
            <!-- Growth Chart -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="text-lg font-semibold text-blue-600 mb-2">Line Chart</h3>
                <canvas id="growthChart" width="400" height="200"></canvas>
            </div>

        </div>
    </div>


    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Low Stock -->
        <div class="bg-white rounded-lg shadow-md p-4">
            <h3 class="text-lg font-semibold text-yellow-600 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i> Low Stock Alerts</h3>
            <div class="overflow-x-auto">
                <table id="lowStockTable" class="min-w-full table-auto text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2">Product</th>
                            <th class="px-4 py-2">SKU</th>
                            <th class="px-4 py-2">Min Level</th>
                            <th class="px-4 py-2">Current Stock</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <!-- JS will populate -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Over Stock -->
        <div class="bg-white rounded-lg shadow-md p-4">
            <h3 class="text-lg font-semibold text-red-600 mb-4"><i class="fas fa-layer-group mr-2"></i> Over Stock Alerts</h3>
            <div class="overflow-x-auto">
                <table id="overStockTable" class="min-w-full table-auto text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2">Product</th>
                            <th class="px-4 py-2">SKU</th>
                            <th class="px-4 py-2">Max Level</th>
                            <th class="px-4 py-2">Current Stock</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <!-- JS will populate -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <!-- Detailed Transaction Summary Table -->
        <div class="bg-white rounded-lg shadow-md p-4">
            <h3 class="text-lg font-semibold text-gray-700 mb-4"><i class="fas fa-list mr-2"></i> Detailed Transaction Summary</h3>
            <table id="detailedTransactionSummaryTable" class="min-w-full table-auto text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2">Item Name</th>
                        <th class="px-4 py-2">Total Transactions</th>
                        <th class="px-4 py-2">Purchase</th>
                        <th class="px-4 py-2">Sale</th>
                        <th class="px-4 py-2">Adjusted In</th>
                        <th class="px-4 py-2">Adjusted Out</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <!-- JS will populate -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- SKU Master Section -->
<div id="skuMaster" class="section">
    <!-- Header Section with Title and Action Buttons -->
    <div class="flex flex-wrap items-center justify-between w-full gap-4 mb-6">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg shadow-md">
                <i class="fas fa-boxes text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">SKU Master</h2>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <button id="addSKUButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-plus mr-2"></i> Add SKU
            </button>
            <button id="importSKUButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="openModal('skuImportModal')">
                <i class="fas fa-upload mr-2"></i> Import SKUs
            </button>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="bg-white shadow-lg rounded-lg p-6 my-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <!-- SKU ID Filter -->
            <div class="w-full">
                <label for="skuSearchInput" class="block text-sm font-medium text-gray-700 mb-1">SKU ID</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-barcode"></i>
                    </span>
                    <input type="text" id="skuSearchInput" list="skus" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by SKU ID" onkeyup="filterSKUs()">
                    <datalist id="skus">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>
            
            <!-- Warehouse Filter -->
            <div class="w-full">
                <label for="warehouseFilter" class="block text-sm font-medium text-gray-700 mb-1">Warehouse</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-warehouse"></i>
                    </span>
                    <input type="text" id="warehouseFilter" list="warehouses" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by Warehouse" onkeyup="filterSKUs()">
                    <datalist id="warehouses">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>

            <!-- Item Name Filter -->
            <div class="w-full">
                <label for="itemSearchInput" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-tag"></i>
                    </span>
                    <input type="text" id="itemSearchInput" list="itemNames" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by Item Name" onkeyup="filterSKUs()">
                    <datalist id="itemNames">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>

            <!-- UOM Filter -->
            <div class="w-full">
                <label for="uomFilter" class="block text-sm font-medium text-gray-700 mb-1">UOM</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-ruler"></i>
                    </span>
                    <input type="text" id="uomFilter" list="uoms" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by UOM" onkeyup="filterSKUs()">
                    <datalist id="uoms">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>

            <!-- Status Filter -->
            <div class="w-full">
                <label for="statusFilter" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-toggle-on"></i>
                    </span>
                    <select id="statusFilter" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm transition duration-200" onchange="filterSKUs()">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Reset Filter Button -->
        <div class="flex justify-end mt-4">
            <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetFilters()">
                <i class="fas fa-times-circle mr-2"></i>
                <span>Reset Filters</span>
            </button>
        </div>
    </div>

    <!-- Export Buttons -->
    <div class="flex flex-wrap items-center gap-2 mt-4">
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('skuTable', 'csv')">
            <i class="fas fa-file-csv mr-2"></i>
            <span>Export CSV</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('skuTable', 'excel')">
            <i class="fas fa-file-excel mr-2"></i>
            <span>Export Excel</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('skuTable', 'pdf')">
            <i class="fas fa-file-pdf mr-2"></i>
            <span>Export PDF</span>
        </button>
    </div>

    <!-- Table -->
    <div class="bg-white shadow-lg rounded-lg my-6 overflow-hidden">
        <div class="overflow-x-auto">
            <div class="p-1" style="max-height: 750px; overflow-y: auto;">
                <table id="skuTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 0)">
                                <div class="flex items-center">
                                    ID <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 1)">
                                <div class="flex items-center">
                                    Item Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 2)">
                                <div class="flex items-center">
                                    SKU <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 3)">
                                <div class="flex items-center">
                                    UOM <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 4)">
                                <div class="flex items-center">
                                    Min Lvl <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 5)">
                                <div class="flex items-center">
                                    Max Lvl <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 6)">
                                <div class="flex items-center">
                                    Reorder Qty <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 7)">
                                <div class="flex items-center">
                                    Warehouse <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 8)">
                                <div class="flex items-center">
                                    Location <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 9)">
                                <div class="flex items-center">
                                    Opening Stock <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 10)">
                                <div class="flex items-center">
                                    Price <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 16)">
                                <div class="flex items-center">
                                    Status <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', false, 17)">
                                <div class="flex items-center">
                                    Added On <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'skuTable', true, 18)">
                                <div class="flex items-center">
                                    Current Stock <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="skuTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Enhanced styling for the SKU Master section */
    
    /* Table row styling */
    #skuTableBody tr:nth-child(even) {
        background-color: #f8fafc;
    }
    
    #skuTableBody tr:hover {
        background-color: #f1f5f9;
    }
    
    /* Action buttons in table styling */
    .action-button {
        padding: 0.375rem 0.625rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        transition: all 0.2s ease-in-out;
        display: inline-flex;
        align-items: center;
        margin-right: 0.25rem;
    }
    
    .action-button.edit {
        background-color: #4f46e5;
        color: white;
    }
    
    .action-button.edit:hover {
        background-color: #4338ca;
    }
    
    .action-button.delete {
        background-color: #ef4444;
        color: white;
    }
    
    .action-button.delete:hover {
        background-color: #dc2626;
    }
    
    .action-button.view {
        background-color: #10b981;
        color: white;
    }
    
    .action-button.view:hover {
        background-color: #059669;
    }
    
    /* Status badge styling */
    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
    }
    
    .status-badge.active {
        background-color: #dcfce7;
        color: #15803d;
    }
    
    .status-badge.inactive {
        background-color: #fee2e2;
        color: #b91c1c;
    }
    
    /* Responsive styles */
    @media (max-width: 1280px) {
        .grid-cols-5 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }
    }
    
    @media (max-width: 1024px) {
        #skuTable {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        #skuTable th,
        #skuTable td {
            min-width: 100px;
        }
    }
    
    @media (max-width: 768px) {
        .grid-cols-3 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }
    
    @media (max-width: 640px) {
        .grid-cols-2 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
    }
</style>

<script>
    // Function to create sample row with enhanced styling
    function createEnhancedSKURow(item) {
        const row = document.createElement('tr');
        
        // Format status badge
        let statusBadge = `<span class="status-badge ${item.status.toLowerCase()}">${item.status}</span>`;
        
        // Format action buttons
        let actionButtons = `
            <button class="action-button view" onclick="viewSKU(${item.id})">
                <i class="fas fa-eye mr-1"></i> View
            </button>
            <button class="action-button edit" onclick="editSKU(${item.id})">
                <i class="fas fa-edit mr-1"></i> Edit
            </button>
            <button class="action-button delete" onclick="confirmDeleteSKU(${item.id})">
                <i class="fas fa-trash mr-1"></i> Delete
            </button>
        `;
        
        // Populate row with data
        row.innerHTML = `
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.id}</td>
            <td class="px-4 py-2 text-sm text-gray-900">${item.name}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">${item.sku}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.uom}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.minLevel}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.maxLevel}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.reorderQty}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.warehouse}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.location}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.openingStock}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">$${item.price.toFixed(2)}</td>
            <td class="px-4 py-2 whitespace-nowrap">${statusBadge}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.addedOn}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.currentStock}</td>
            <td class="px-4 py-2 whitespace-nowrap text-xs">${actionButtons}</td>
        `;
        
        return row;
    }
    
    // Add sort icon change functionality
    function updateSortIcon(header, direction) {
        // Remove any existing sort icons
        const allHeaders = document.querySelectorAll('#skuTable th i.fas');
        allHeaders.forEach(icon => {
            icon.className = 'fas fa-sort ml-1 text-gray-400';
        });
        
        // Add the appropriate sort icon
        const icon = header.querySelector('i.fas');
        if (icon) {
            icon.className = direction === 'asc' 
                ? 'fas fa-sort-up ml-1 text-indigo-600' 
                : 'fas fa-sort-down ml-1 text-indigo-600';
        }
    }
    
    // Enhanced sort table function
    function sortTable(header, tableId, isNumeric, columnIndex) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        // Determine current sort direction
        const currentDirection = header.getAttribute('data-sort-direction') || 'asc';
        const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
        
        // Update sort direction attribute
        header.setAttribute('data-sort-direction', newDirection);
        
        // Update sort icon
        updateSortIcon(header, newDirection);
        
        // Sort the rows
        rows.sort((a, b) => {
            let aValue = a.cells[columnIndex].textContent.trim();
            let bValue = b.cells[columnIndex].textContent.trim();
            
            if (isNumeric) {
                // Extract numeric value, handling currency symbols and commas
                aValue = parseFloat(aValue.replace(/[^0-9.-]+/g, ''));
                bValue = parseFloat(bValue.replace(/[^0-9.-]+/g, ''));
                
                // Handle NaN cases
                if (isNaN(aValue)) aValue = 0;
                if (isNaN(bValue)) bValue = 0;
            }
            
            if (newDirection === 'asc') {
                return isNumeric 
                    ? aValue - bValue 
                    : aValue.localeCompare(bValue);
            } else {
                return isNumeric 
                    ? bValue - aValue 
                    : bValue.localeCompare(aValue);
            }
        });
        
        // Remove existing rows and add sorted rows
        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }
        
        rows.forEach(row => tbody.appendChild(row));
    }
</script>

<div id="warehousesection" class="section">
    <div class="flex flex-wrap items-center justify-between w-full gap-4 mb-6">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg shadow-md">
                <i class="fas fa-warehouse text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">Warehouse Master</h2>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <button id="addWarehouseButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-plus mr-2"></i> Add Warehouse
            </button>
            <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetFilters()">
                <i class="fas fa-times-circle mr-2"></i> <span>Reset Filters</span>
            </button>
        </div>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-6 my-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            <div class="w-full">
                <label for="warehouseSearchInput" class="block text-sm font-medium text-gray-700 mb-1">Warehouse Name</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-building"></i>
                    </span>
                    <input type="text" id="warehouseSearchInput" list="warehouses" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by name..." onkeyup="filterWarehouses()">
                    <datalist id="warehouses">
                        </datalist>
                </div>
            </div>
            <div class="w-full">
                <label for="managerFilter" class="block text-sm font-medium text-gray-700 mb-1">Manager</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-user"></i>
                    </span>
                    <select id="managerFilter" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm transition duration-200" onchange="filterWarehouses()">
                        <option value="">All Managers</option>
                        </select>
                </div>
            </div>
            </div>
    </div>

    <div class="flex flex-wrap items-center gap-2 mt-4">
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('warehouseTable', 'csv')">
            <i class="fas fa-file-csv mr-2"></i> <span>Export CSV</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('warehouseTable', 'excel')">
            <i class="fas fa-file-excel mr-2"></i> <span>Export Excel</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('warehouseTable', 'pdf')">
            <i class="fas fa-file-pdf mr-2"></i> <span>Export PDF</span>
        </button>
    </div>

    <div class="bg-white shadow-lg rounded-lg my-6 overflow-hidden">
        <div class="overflow-x-auto">
            <div class="p-1" style="max-height: 750px; overflow-y: auto;">
                <table id="warehouseTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'warehouseTable', true, 0)">
                                <div class="flex items-center">
                                    ID <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'warehouseTable', false, 1)">
                                <div class="flex items-center">
                                    Warehouse Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'warehouseTable', false, 2)">
                                <div class="flex items-center">
                                    Location <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'warehouseTable', false, 3)">
                                <div class="flex items-center">
                                    Manager Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'warehouseTable', false, 4)">
                                <div class="flex items-center">
                                    Added On <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="warehouseTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div id="suppliers" class="section">
    <div class="flex flex-wrap items-center justify-between w-full gap-4 mb-6">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg shadow-md">
                <i class="fas fa-truck text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">Supplier Master</h2>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <button id="addSupplierButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-plus mr-2"></i> Add Supplier
            </button>
            <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetFilters()">
                <i class="fas fa-times-circle mr-2"></i> <span>Reset Filters</span>
            </button>
        </div>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-6 my-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <div class="w-full">
                <label for="supplierSearchInput" class="block text-sm font-medium text-gray-700 mb-1">Supplier Name</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-signature"></i>
                    </span>
                    <input type="text" id="supplierSearchInput" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by name..." onkeyup="filterSuppliers()">
                </div>
            </div>
            <div class="w-full">
                <label for="cityFilter" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-city"></i>
                    </span>
                    <input type="text" id="cityFilter" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by city..." onkeyup="filterSuppliers()">
                </div>
            </div>
            <div class="w-full">
                <label for="stateFilter" class="block text-sm font-medium text-gray-700 mb-1">State</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-map-marker-alt"></i>
                    </span>
                    <input type="text" id="stateFilter" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by state..." onkeyup="filterSuppliers()">
                </div>
            </div>
            </div>
        <div class="flex justify-end mt-4">
            <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetFilters()">
                <i class="fas fa-times-circle mr-2"></i>
                <span>Reset Filters</span>
            </button>
        </div>
    </div>

    <div class="flex flex-wrap items-center gap-2 mt-4">
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('supplierTable', 'csv')">
            <i class="fas fa-file-csv mr-2"></i> <span>Export CSV</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('supplierTable', 'excel')">
            <i class="fas fa-file-excel mr-2"></i> <span>Export Excel</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('supplierTable', 'pdf')">
            <i class="fas fa-file-pdf mr-2"></i> <span>Export PDF</span>
        </button>
    </div>

    <div class="bg-white shadow-lg rounded-lg my-6 overflow-hidden">
        <div class="overflow-x-auto">
            <div class="p-1" style="max-height: 750px; overflow-y: auto;">
                <table id="supplierTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 0)">
                                <div class="flex items-center">
                                    Date Added <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 1)">
                                <div class="flex items-center">
                                    Supplier ID <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 2)">
                                <div class="flex items-center">
                                    Supplier Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 3)">
                                <div class="flex items-center">
                                    Contact Person <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 4)">
                                <div class="flex items-center">
                                    Contact Number <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address Line 1</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address Line 2</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address Line 3</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 8)">
                                <div class="flex items-center">
                                    City <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 9)">
                                <div class="flex items-center">
                                    State <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'supplierTable', false, 10)">
                                <div class="flex items-center">
                                    Pincode <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GST</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Whatsapp</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="supplierTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



  <!-- Location Section -->
  <div id="locations" class="section">
            <h1>Locations</h1>
            <button id="addLocationButton" class="btn btn-primary"><i class="fas fa-plus"></i> Add Location</button>
            <div class="table-container">
                <table id="locationTable" class="inventory-table">
                      <thead>
                          <tr>
                              <th onclick="sortTable(this, 'locationTable', false, 0)">Location ID</th>
                              <th onclick="sortTable(this, 'locationTable', false, 1)">Location</th>
                              <th onclick="sortTable(this, 'locationTable', false, 2)">Location Handler</th>
                          </tr>
                      </thead>
                      <tbody></tbody>
                </table>
            </div>
  </div>
<div id="skuVendorMapping" class="section">
    <!-- Header Section -->
    <div class="flex flex-wrap items-center justify-between w-full gap-4 mb-6">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg shadow-md">
                <i class="fas fa-boxes text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">SKU to Vendor Mapping</h2>
        </div>
        <button id="refreshVendorMappingButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="loadSKUsForVendorMapping()">
            <i class="fas fa-sync-alt mr-2"></i> Refresh
        </button>
    </div>

    <!-- Filter Section -->
    <div class="bg-white shadow-lg rounded-lg p-6 my-6">
        <div class="flex flex-col md:flex-row items-start md:items-end gap-4">
            <div class="w-full md:w-auto flex-1">
                <label for="skuSearchInputMapping" class="block text-sm font-medium text-gray-700 mb-1">SKU</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="skuSearchInputMapping" list="skus" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by SKU..." onkeyup="filterSKUsForVendorMapping()">
                    <datalist id="skus">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>
            
            <div class="w-full md:w-auto flex-1">
                <label for="itemSearchInputMapping" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-tag"></i>
                    </span>
                    <input type="text" id="itemSearchInputMapping" list="itemNames" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by Item Name..." onkeyup="filterSKUsForVendorMapping()">
                    <datalist id="itemNames">
                        <!-- Options will be populated dynamically -->
                    </datalist>
                </div>
            </div>
            
            <div class="w-full md:w-auto">
                <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetVendorMappingFilters()">
                    <i class="fas fa-times-circle"></i>
                    <span>Reset Filters</span>
                </button>
            </div>
        </div>
        
        <div class="flex justify-center mt-6">
            <button id="saveVendorMappingButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-save mr-2"></i> Save Changes
            </button>
        </div>
    </div>

    <!-- Table Section -->
    <div class="bg-white shadow-lg rounded-lg my-6 overflow-hidden">
        <div class="overflow-x-auto">
            <div class="p-1" style="max-height: 750px; overflow-y: auto;">
                <table id="skuVendorMappingTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item Name</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor 1</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor 2</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor 3</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor 4</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor 5</th>
                        </tr>
                    </thead>
                    <tbody id="skuVendorMappingTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Enhanced styling for vendor input fields */
    .vendor-input {
        transition: all 0.2s ease-in-out;
        border: 1px solid #e2e8f0;
        border-radius: 0.375rem;
        padding: 0.5rem;
        width: 100%;
        font-size: 0.875rem;
    }
    
    .vendor-input:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    
    /* Highlight empty vendor inputs */
    .vendor-input:placeholder-shown {
        background-color: #f9fafb;
        border: 1px dashed #cbd5e1;
    }
    
    /* Highlight cells when being edited */
    .editing-cell {
        background-color: #eff6ff !important;
    }
    
    /* Responsive table styles */
    @media (max-width: 1024px) {
        #skuVendorMappingTable {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        #skuVendorMappingTable th,
        #skuVendorMappingTable td {
            min-width: 120px;
        }
    }
    
    /* Zebra striping for better readability */
    #skuVendorMappingTableBody tr:nth-child(even) {
        background-color: #f8fafc;
    }
    
    #skuVendorMappingTableBody tr:hover {
        background-color: #f1f5f9;
    }
</style>

<script>
    // JavaScript to handle input focus and highlighting
    document.addEventListener('DOMContentLoaded', function() {
        // Function to add event listeners to vendor inputs
        function setupVendorInputs() {
            const vendorInputs = document.querySelectorAll('.vendor-input');
            
            vendorInputs.forEach(input => {
                // Add focus event
                input.addEventListener('focus', function() {
                    this.closest('td').classList.add('editing-cell');
                });
                
                // Add blur event
                input.addEventListener('blur', function() {
                    this.closest('td').classList.remove('editing-cell');
                });
            });
        }
        
        // Call setup function initially
        setupVendorInputs();
        
        // Set up a mutation observer to watch for dynamic content changes
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' && mutation.target.id === 'skuVendorMappingTableBody') {
                    setupVendorInputs();
                }
            });
        });
        
        // Start observing the table body for changes
        const tableBody = document.getElementById('skuVendorMappingTableBody');
        if (tableBody) {
            observer.observe(tableBody, { childList: true, subtree: true });
        }
    });
    
    // Enhanced row creation function (to be included in your existing JavaScript)
    function createVendorMappingRow(item) {
        const row = document.createElement('tr');
        
        // Add standard cells
        row.innerHTML = `
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.id}</td>
            <td class="px-4 py-2 text-sm text-gray-900">${item.name}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${item.sku}</td>
        `;
        
        // Add vendor cells with enhanced input styling
        for (let i = 1; i <= 5; i++) {
            const vendorCell = document.createElement('td');
            vendorCell.className = 'px-4 py-2';
            
            const vendorInput = document.createElement('input');
            vendorInput.type = 'text';
            vendorInput.className = 'vendor-input';
            vendorInput.placeholder = 'Select vendor...';
            vendorInput.value = item[`vendor${i}`] || '';
            vendorInput.setAttribute('data-vendor-number', i);
            vendorInput.setAttribute('data-sku-id', item.id);
            
            vendorCell.appendChild(vendorInput);
            row.appendChild(vendorCell);
        }
        
        return row;
    }
</script>

<!-- Reports Section -->
<div id="reports" class="section">
    <div class="flex items-center justify-between w-full">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg">
                <i class="fas fa-chart-pie text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">Reports</h2>
        </div>
        <div class="flex items-center">
            <button id="generateStockAgingReportButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">
                <i class="fas fa-chart-bar mr-1"></i> Stock Aging Report
            </button>
            <button id="generateSalesDispatchReportButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">
                <i class="fas fa-chart-bar mr-1"></i> Sales Dispatch Report
            </button>
            <button id="generateSalesReturnReportButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">
                <i class="fas fa-chart-bar mr-1"></i> Sales Return Report
            </button>
        </div>
    </div>

    <!-- Stock Aging Report -->
    <div class="bg-white shadow-md rounded my-6 overflow-y-auto p-6" style="max-height: 750px;" id="stockAgingReportContainer">
        <table id="stockAgingReportTable" class="min-w-full divide-y divide-gray-200 table-fixed">
            <thead class="bg-gray-50 sticky top-0 z-5">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', false, 0)">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', false, 1)">Item Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', false, 2)">SKU</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', false, 3)">Added On</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', true, 4)">Days Since Added</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', false, 5)">Last Transaction On</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', true, 6)">Days Since Last Transaction</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'stockAgingReportTable', true, 7)">Total Transactions</th>
                </tr>
            </thead>
            <tbody id="stockAgingReportTableBody" class="bg-white divide-y divide-gray-200">
                <!-- Table rows will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <div class="flex justify-center mt-4" id="exportButtonsContainer">
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg flex items-center space-x-2" onclick="exportTable('stockAgingReportTable', 'csv')">
            <i class="fas fa-file-csv mr-1"></i>
            <span>Export CSV</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg flex items-center space-x-2" onclick="exportTable('stockAgingReportTable', 'excel')">
            <i class="fas fa-file-excel mr-1"></i>
            <span>Export Excel</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg flex items-center space-x-2" onclick="exportTable('stockAgingReportTable', 'pdf')">
            <i class="fas fa-file-pdf mr-1"></i>
            <span>Export PDF</span>
        </button>
    </div>

    <!-- Sales Dispatch Report -->
    <div class="bg-white shadow-md rounded my-6 overflow-y-auto p-6" style="max-height: 750px;" id="salesDispatchReportContainer" style="display:none;">
        <div class="flex flex-wrap items-center gap-4">
            <div class="w-auto px-2">
                <label for="salesOrderFilter" class="block text-sm font-medium text-gray-700">Sales Order</label>
                <input type="text" id="salesOrderFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Sales Order" onkeyup="applySalesDispatchFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="itemNameDispatchFilter" class="block text-sm font-medium text-gray-700">Item Name</label>
                <input type="text" id="itemNameDispatchFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Item Name" onkeyup="applySalesDispatchFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="skuDispatchFilter" class="block text-sm font-medium text-gray-700">SKU</label>
                <input type="text" id="skuDispatchFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by SKU" onkeyup="applySalesDispatchFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="statusDispatchFilter" class="block text-sm font-medium text-gray-700">Status</label>
                <select id="statusDispatchFilter" onchange="applySalesDispatchFilters()" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm">
                    <option value="">All Status</option>
                    <option value="Partially">Partially</option>
                    <option value="Dispatched">Dispatched</option>
                </select>
            </div>
            <div class="w-auto px-2">
                <label for="dispatchStartDate" class="block text-sm font-medium text-gray-700">From</label>
                <input type="date" id="dispatchStartDate" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm" onchange="applySalesDispatchFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="dispatchEndDate" class="block text-sm font-medium text-gray-700">To</label>
                <input type="date" id="dispatchEndDate" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm" onchange="applySalesDispatchFilters()">
            </div>
            <div class="w-auto px-2">
                <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 mt-4" onclick="resetSalesDispatchFilters()">
                    <span>Reset Filters</span>
                </button>
            </div>
        </div>
        <table id="salesDispatchReportTable" class="min-w-full divide-y divide-gray-200 table-fixed mt-4">
            <thead class="bg-gray-50 sticky top-0 z-5">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 0)">Sales Order</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 1)">Timestamp</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 2)">Item Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 3)">SKU</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', true, 4)">QUANTITY</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', true, 5)">Dispatch Quantity</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', true, 6)">Remaining Quantity</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 7)">Dispatch Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesDispatchReportTable', false, 8)">Status</th>
                </tr>
            </thead>
            <tbody id="salesDispatchReportTableBody" class="bg-white divide-y divide-gray-200">
                <!-- Table rows will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Sales Return Report -->
    <div class="bg-white shadow-md rounded my-6 overflow-y-auto p-6" style="max-height: 750px;" id="salesReturnReportContainer" style="display:none;">
        <div class="flex flex-wrap items-center gap-4">
            <div class="w-auto px-2">
                <label for="returnIdFilter" class="block text-sm font-medium text-gray-700">Return ID</label>
                <input type="text" id="returnIdFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Return ID" onkeyup="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="orderIdFilter" class="block text-sm font-medium text-gray-700">Order ID</label>
                <input type="text" id="orderIdFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Order ID" onkeyup="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="customerNameFilter" class="block text-sm font-medium text-gray-700">Customer Name</label>
                <input type="text" id="customerNameFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Customer Name" onkeyup="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="itemNameReturnFilter" class="block text-sm font-medium text-gray-700">Item Name</label>
                <input type="text" id="itemNameReturnFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by Item Name" onkeyup="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="skuReturnFilter" class="block text-sm font-medium text-gray-700">SKU</label>
                <input type="text" id="skuReturnFilter" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm placeholder-gray-500" placeholder="Search by SKU" onkeyup="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="statusReturnFilter" class="block text-sm font-medium text-gray-700">Status</label>
                <select id="statusReturnFilter" onchange="applySalesReturnFilters()" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm">
                    <option value="">All Status</option>
                    <option value="Approved">Approved</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="w-auto px-2">
                <label for="returnStartDate" class="block text-sm font-medium text-gray-700">From</label>
                <input type="date" id="returnStartDate" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm" onchange="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <label for="returnEndDate" class="block text-sm font-medium text-gray-700">To</label>
                <input type="date" id="returnEndDate" class="form-control rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 w-full px-3 py-2 text-sm" onchange="applySalesReturnFilters()">
            </div>
            <div class="w-auto px-2">
                <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg flex items-center space-x-2 mt-4" onclick="resetSalesReturnFilters()">
                    <span>Reset Filters</span>
                </button>
            </div>
        </div>
        <table id="salesReturnReportTable" class="min-w-full divide-y divide-gray-200 table-fixed mt-4">
            <thead class="bg-gray-50 sticky top-0 z-5">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 0)">Return ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 1)">Order ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 2)">Customer Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 3)">Item Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 4)">SKU</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', true, 5)">Remaining Units</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', true, 6)">Dispatch Units</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', true, 7)">Return Units</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 8)">Remark</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 9)">Return Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 10)">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 11)">Return Action</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable(this, 'salesReturnReportTable', false, 12)">Timestamp</th>
                </tr>
            </thead>
            <tbody id="salesReturnReportTableBody" class="bg-white divide-y divide-gray-200">
                <!-- Table rows will be populated dynamically -->
            </tbody>
        </table>
    </div>
</div>

<div id="transactions" class="section">
    <div class="flex flex-wrap items-center justify-between w-full gap-4 mb-6">
        <div class="flex items-center space-x-3">
            <span class="bg-indigo-600 p-2 rounded-lg shadow-md">
                <i class="fas fa-exchange-alt text-white"></i>
            </span>
            <h2 class="text-2xl font-bold text-gray-800">Inventory Transactions</h2>
        </div>
        <div class="flex flex-wrap items-center gap-2">
            <button id="addAdjustmentButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-plus mr-2"></i> Add Adjustment
            </button>
            <button id="importTransactionButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="openModal('transactionImportModal')">
                <i class="fas fa-upload mr-2"></i> Import Transactions
            </button>
        </div>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-6 my-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            <div class="w-full">
                <label for="transactionSearchInput" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-tag"></i>
                    </span>
                    <input type="text" id="transactionSearchInput" list="itemNames" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm placeholder-gray-500 transition duration-200" placeholder="Search by Item Name" onkeyup="applyTransactionFilters()">
                    <datalist id="itemNames"></datalist>
                </div>
            </div>

            <div class="w-full">
                <label for="transactionTypeFilter" class="block text-sm font-medium text-gray-700 mb-1">Transaction Type</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-filter"></i>
                    </span>
                    <select id="transactionTypeFilter" onchange="applyTransactionFilters()" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm transition duration-200">
                        <option value="">All Types</option>
                        <option value="Adjusted In">Adjusted In</option>
                        <option value="Adjusted Out">Adjusted Out</option>
                        <option value="Purchase">Purchase</option>
                        <option value="Sale">Sale</option>
                    </select>
                </div>
            </div>

            <div class="w-full">
                <label for="transactionStartDate" class="block text-sm font-medium text-gray-700 mb-1">From</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-calendar-alt"></i>
                    </span>
                    <input type="date" id="transactionStartDate" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm transition duration-200" onchange="applyTransactionFilters()">
                </div>
            </div>

            <div class="w-full">
                <label for="transactionEndDate" class="block text-sm font-medium text-gray-700 mb-1">To</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-500">
                        <i class="fas fa-calendar-alt"></i>
                    </span>
                    <input type="date" id="transactionEndDate" class="form-control rounded-md border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full pl-10 pr-3 py-2 text-sm transition duration-200" onchange="applyTransactionFilters()">
                </div>
            </div>
        </div>

        <div class="flex justify-end mt-4">
            <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center space-x-2" onclick="resetTransactionFilters()">
                <i class="fas fa-times-circle mr-2"></i>
                <span>Reset Filters</span>
            </button>
        </div>
    </div>

    <div class="flex flex-wrap items-center gap-2 mt-4">
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('transactionTable', 'csv')">
            <i class="fas fa-file-csv mr-2"></i>
            <span>Export CSV</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('transactionTable', 'excel')">
            <i class="fas fa-file-excel mr-2"></i>
            <span>Export Excel</span>
        </button>
        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center" onclick="exportTable('transactionTable', 'pdf')">
            <i class="fas fa-file-pdf mr-2"></i>
            <span>Export PDF</span>
        </button>
    </div>

    <div class="bg-white shadow-lg rounded-lg my-6 overflow-hidden">
        <div class="overflow-x-auto">
            <div class="p-1" style="max-height: 650px; overflow-y: auto;">
                <table id="transactionTable" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', false, 0)">
                                <div class="flex items-center">
                                    Timestamp <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', true, 1)">
                                <div class="flex items-center">
                                    Transaction ID <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', false, 2)">
                                <div class="flex items-center">
                                    Product Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', false, 3)">
                                <div class="flex items-center">
                                    SKU <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', true, 4)">
                                <div class="flex items-center">
                                    Quantity <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', false, 5)">
                                <div class="flex items-center">
                                    Transaction Type <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-200" onclick="sortTable(this, 'transactionTable', false, 6)">
                                <div class="flex items-center">
                                    Transaction Nature <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="transactionTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   <script>
  let skuCache = [];
  let supplierCache = [];
  let warehouseCache = [];
  let transactionCache = [];
  let locationCache = [];
  let originalSKUData = {};
  let stockMovementChart;
  let top10ItemsByStockChart;
let inventoryByWarehouseChart;

let movementComboChart;

function updateRecentActivities() {
    console.log(' Updating recent activities...');
    google.script.run
        .withSuccessHandler(data => {
            console.log(' Raw data received:', data);
            
            // Detailed inspection of the data
            if (!data) {
                console.error(' Received null or undefined data');
                return;
            }
            
            // Check if recentTransactions exists
            if (!data.hasOwnProperty('recentTransactions')) {
                console.error(' Missing recentTransactions property');
            } else {
                console.log(' recentTransactions exists:', data.recentTransactions);
                
                // Examine the first transaction if available
                if (data.recentTransactions.length > 0) {
                    console.log('First transaction keys:', Object.keys(data.recentTransactions[0]));
                    console.log('First transaction values:', Object.values(data.recentTransactions[0]));
                    console.log('timestamp type:', typeof data.recentTransactions[0].timestamp);
                    console.log('timestamp value:', data.recentTransactions[0].timestamp);
                }
            }
            
            // Check if recentAddSKUs exists
            if (!data.hasOwnProperty('recentAddSKUs')) {
                console.error(' Missing recentAddSKUs property');
            } else {
                console.log(' recentAddSKUs exists:', data.recentAddSKUs);
                
                // Examine the first SKU if available
                if (data.recentAddSKUs.length > 0) {
                    console.log('First SKU keys:', Object.keys(data.recentAddSKUs[0]));
                    console.log('First SKU values:', Object.values(data.recentAddSKUs[0]));
                    console.log('timestamp type:', typeof data.recentAddSKUs[0].timestamp);
                    console.log('timestamp value:', data.recentAddSKUs[0].timestamp);
                }
            }
            
            // Proceed with normal processing
            displayRecentActivities(data.recentTransactions || [], data.recentAddSKUs || []);
        })
        .withFailureHandler(error => {
            console.error(' Failed to get recent activities:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to get recent activities: ' + (error.message || error)
            });
        })
        .getRecentActivities();
}
function displayRecentActivities(transactions, addSKUs) {
    console.log(' Displaying recent activities:', transactions, addSKUs);
    const recentActivitiesContainer = document.getElementById('recentActivities');
    recentActivitiesContainer.innerHTML = '';

    const allActivities = [...transactions, ...addSKUs].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

    if (allActivities.length === 0) {
        recentActivitiesContainer.innerHTML = '<p class="text-gray-500">No recent activities in the last 24 hours.</p>';
        return;
    }

    allActivities.forEach(activity => {
        const activityItem = document.createElement('div');
        activityItem.className = 'p-3 bg-white rounded shadow-sm border border-gray-200';

        if (activity.type === "Transaction") {
            activityItem.innerHTML = `
                <div>
                    <p><strong>Product Name:</strong> ${activity.productName}</p>
                    <p><strong>Qty:</strong> ${activity.quantity}</p>
                    <p><strong>Adjustment Type:</strong> ${activity.adjustmentType}</p>
                    <p><strong>Adjusted On:</strong> ${new Date(activity.timestamp).toLocaleString()}</p>
                </div>
            `;
        } else if (activity.type === "ADD-SKU") {
            activityItem.innerHTML = `
                <div>
                    <p><strong>SKU Name:</strong> ${activity.skuName}</p>
                    <p><strong>Added On:</strong> ${new Date(activity.timestamp).toLocaleString()}</p>
                </div>
            `;
        }

        recentActivitiesContainer.appendChild(activityItem);
    });
}


document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing UI...');
    initializeUI();
    loadInitialData();
    updateRecentActivities(); // Add this line

    // Set default date range (last 30 days)
    const today = new Date();
    const last30Days = new Date(today);
    last30Days.setDate(today.getDate() - 30);
    document.getElementById('startDate').value = last30Days.toISOString().split('T')[0];
    document.getElementById('endDate').value = today.toISOString().split('T')[0];
    updateDashboard();

    // Add event listeners for sorting
    document.querySelectorAll('.inventory-table th').forEach(th => {
        th.addEventListener('click', function(event) {
            event.preventDefault();
            sortTable(this, th.closest('table').id);
        });
        th.addEventListener('dblclick', function(event) {
            event.preventDefault();
            sortTable(this, th.closest('table').id);
        });
    });

    // Add event listeners for buttons
    document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
    document.getElementById('addSKUButton').addEventListener('click', () => showModal('addSKUModal'));
    document.getElementById('addSupplierButton').addEventListener('click', () => showModal('addSupplierModal'));
    document.getElementById('addWarehouseButton').addEventListener('click', () => showModal('addWarehouseModal'));
    document.getElementById('addAdjustmentButton').addEventListener('click', () => showModal('addAdjustmentModal'));
    document.getElementById('addLocationButton').addEventListener('click', () => showModal('addLocationModal'));

    // Close modals
    document.querySelectorAll('.modal .close').forEach(close => {
        close.addEventListener('click', () => closeModal(close.parentElement.parentElement.id));
    });

    // Form submissions
    document.getElementById('addSKUForm').addEventListener('submit', handleAddSKU);
    document.getElementById('editSKUForm').addEventListener('submit', handleEditSKU);
    document.getElementById('addSupplierForm').addEventListener('submit', handleAddSupplier);
    document.getElementById('editSupplierForm').addEventListener('submit', handleEditSupplier);
    document.getElementById('addWarehouseForm').addEventListener('submit', handleAddWarehouse);
    document.getElementById('editWarehouseForm').addEventListener('submit', handleEditWarehouse);
    document.getElementById('addAdjustmentForm').addEventListener('submit', handleAddAdjustment);
    document.getElementById('addLocationForm').addEventListener('submit', handleAddLocation);

    // Filter inputs
    document.getElementById('skuSearchInput').addEventListener('input', filterSKUs);
    document.getElementById('warehouseFilter').addEventListener('change', filterSKUs);
    document.getElementById('itemSearchInput').addEventListener('input', filterSKUs);
    document.getElementById('statusFilter').addEventListener('change', filterSKUs);
    document.getElementById('transactionTypeFilter').addEventListener('change', applyTransactionFilters);
    document.getElementById('transactionStartDate').addEventListener('change', applyTransactionFilters);
    document.getElementById('transactionEndDate').addEventListener('change', applyTransactionFilters);
    document.getElementById('supplierSearchInput').addEventListener('input', filterSuppliers);
    document.getElementById('warehouseSearchInput').addEventListener('input', filterWarehouses);
    document.getElementById('managerFilter').addEventListener('change', filterWarehouses);
});


  function toggleSidebar() {
    console.log('Toggling sidebar...');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.querySelector('.main-content');
    const navItems = document.querySelectorAll('.nav-item');
    const logo = document.querySelector('.sidebar-header .logo');

    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('collapsed');
    navItems.forEach(item => item.classList.toggle('collapsed'));
    logo.classList.toggle('collapsed');
}


  function initializeUI() {
    console.log('Initializing Select2...');
    $('.select2').select2({
      placeholder: 'Select an option',
      allowClear: true,
      width: '100%'
    });
  }

  function initialize() {
    console.log('Initializing data...');
    loadInitialData();
  }

 function loadUniqueValues() {
  console.log('Loading unique values...');
  Promise.all([
    google.script.run.withSuccessHandler(itemNames => {
      console.log('Loaded Item Names:', itemNames);
      const datalist = document.getElementById('itemNames');
      datalist.innerHTML = '';
      itemNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        datalist.appendChild(option);
      });
    }).withFailureHandler(error => {
      console.error('Failed to load item names:', error);
    }).getUniqueItemNames(),

    google.script.run.withSuccessHandler(skus => {
      console.log('Loaded SKUs:', skus);
      const datalist = document.getElementById('skus');
      datalist.innerHTML = '';
      skus.forEach(sku => {
        const option = document.createElement('option');
        option.value = sku;
        datalist.appendChild(option);
      });
    }).withFailureHandler(error => {
      console.error('Failed to load SKUs:', error);
    }).getUniqueSKUs(),

    google.script.run.withSuccessHandler(uoms => {
      console.log('Loaded UOMs:', uoms);
      const datalist = document.getElementById('uoms');
      datalist.innerHTML = '';
      uoms.forEach(uom => {
        const option = document.createElement('option');
        option.value = uom;
        datalist.appendChild(option);
      });
    }).withFailureHandler(error => {
      console.error('Failed to load UOMs:', error);
    }).getUniqueUOMs(),

    google.script.run.withSuccessHandler(warehouses => {
      console.log('Loaded Warehouses:', warehouses);
      const datalist = document.getElementById('warehouses');
      datalist.innerHTML = '';
      warehouses.forEach(warehouse => {
        const option = document.createElement('option');
        option.value = warehouse;
        datalist.appendChild(option);
      });
    }).withFailureHandler(error => {
      console.error('Failed to load Warehouses:', error);
    }).getUniqueWarehouses()
  ]).then(() => {
    console.log('All unique values loaded.');
  }).catch(error => {
    console.error('Error loading unique values:', error);
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to load unique values' });
  });
}

// Add this function call in the loadInitialData function
function loadInitialData() {
  console.log('Loading initial data...');
  Promise.all([
    loadSKUs(),
    loadSuppliers(),
    loadWarehouses(),
    loadTransactions(),
    loadUniqueValues() // Add this line
  ]).then(() => {
    console.log('All data loaded, populating dropdowns...');
    populateDropdowns();
  }).catch(error => {
    console.error('Error loading initial data:', error);
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to load initial data' });
  });
}
  function showModal(modalId) {
  console.log('Showing modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.style.display = 'flex';
    setTimeout(() => {
      modal.classList.add('show');
      modal.querySelector('.modal-content').classList.add('show');
    }, 10);
  } else {
    console.error('Modal not found:', modalId);
    Swal.fire({ icon: 'error', title: 'Error', text: 'Modal not found' });
  }
}

function closeModal(modalId) {
  console.log('Closing modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('show', 'flex');
    const content = modal.querySelector('.modal-content');
    if (content) {
      content.classList.remove('show', 'flex');
    }

    setTimeout(() => {
      modal.style.display = 'none';
    }, 300);

    const fileInput = modal.querySelector('input[type="file"]');
    if (fileInput) fileInput.value = ''; // Reset file input
  } else {
    console.error('Modal not found:', modalId);
  }
}

  async function loadSKUs() {
    return new Promise((resolve, reject) => {
      console.log('Loading SKUs...');
      google.script.run.withSuccessHandler(skus => {
        console.log('Loaded SKUs:', skus);
        skuCache = skus;
        displaySKUs(skuCache);
        resolve();
      }).withFailureHandler(error => {
        console.error('Failed to load SKUs:', error);
        reject(error);
      }).getSKUs();
    });
  }

  async function loadSuppliers() {
    return new Promise((resolve, reject) => {
      console.log('Loading Suppliers...');
      google.script.run.withSuccessHandler(suppliers => {
        console.log('Loaded Suppliers:', suppliers);
        supplierCache = suppliers;
        displaySuppliers(supplierCache);
        resolve();
      }).withFailureHandler(error => {
        console.error('Failed to load Suppliers:', error);
        reject(error);
      }).getSuppliers();
    });
  }

  async function loadWarehouses() {
    return new Promise((resolve, reject) => {
      console.log('Loading Warehouses...');
      google.script.run.withSuccessHandler(warehouses => {
        console.log('Loaded Warehouses:', warehouses);
        warehouseCache = warehouses;
        displayWarehouses(warehouseCache);
        resolve();
      }).withFailureHandler(error => {
        console.error('Failed to load Warehouses:', error);
        reject(error);
      }).getWarehouseData();
    });
  }

  async function loadTransactions() {
    return new Promise((resolve, reject) => {
      console.log('Loading Transactions...');
      google.script.run.withSuccessHandler(transactions => {
        console.log('Loaded Transactions:', transactions);
        transactionCache = transactions;
        displayTransactions(transactionCache);
        resolve();
      }).withFailureHandler(error => {
        console.error('Failed to load Transactions:', error);
        reject(error);
      }).getTransactions();
    });
  }


  function populateSKUDropdowns() {
    console.log('Populating SKU dropdowns...');
    loadWarehousesForSelect('#warehouse', 'Select Warehouse');
    loadLocationsForSelect('#location', 'Select Location');
  }

 function toggleSKUStatus(skuId, itemName, currentStatus) {
  console.log('Toggling status for SKU:', skuId, 'Item Name:', itemName, 'Current Status:', currentStatus);
  const newStatus = currentStatus === 'Active' ? 'Inactive' : 'Active';
  
  Swal.fire({
    title: 'Confirm Status Change',
    text: `Do you want to change ${itemName} to ${newStatus}?`,
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'Yes, change it!',
    cancelButtonText: 'No, cancel!'
  }).then((result) => {
    if (result.isConfirmed) {
      updateSKUStatus(skuId, newStatus);
    }
  });
}

function updateSKUStatus(skuId, newStatus) {
  console.log('Updating SKU status:', skuId, 'to', newStatus);
  google.script.run.withSuccessHandler(() => {
    Swal.fire({ icon: 'success', title: 'Success!', text: 'SKU status updated successfully', timer: 1500 });
    loadSKUs(); // Refresh the SKU list to reflect the change
  }).withFailureHandler(error => {
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update SKU status: ' + error.message });
    console.error('Failed to update SKU status:', error);
  }).updateSKUStatus(skuId, newStatus);
}

function displaySKUs(skus) {
  console.log('Displaying SKUs:', skus);
  const tbody = document.querySelector('#skuTable tbody');
  tbody.innerHTML = skus.map(sku => {
    const isActive = sku.status === 'Active';
    return `
      <tr>
        <td>${sku.id}</td>
        <td>${sku.itemName}</td>
        <td>${sku.sku}</td>
        <td>${sku.uom}</td>
        <td>${sku.minLvl}</td>
        <td>${sku.maxLvl}</td>
        <td>${sku.reorderQty}</td>
        <td>${sku.warehouse}</td>
        <td>${sku.location}</td>
        <td>${sku.openingStock}</td>
        <td>${sku.price}</td>
        
        <td>${sku.status}</td>
        <td>${sku.addedOn}</td>
        <td>${sku.currentStock}</td>
        <td>
          <button class="edit-btn" onclick='openEditSKUModal(${JSON.stringify(sku)})'>
            <i class="fas fa-edit"></i>
          </button>
          <button class="edit-btn" onclick='toggleSKUStatus("${sku.sku}", "${sku.itemName}", "${sku.status}")' title="Toggle Status">
            <i class="fas ${isActive ? 'fa-toggle-on text-green-500' : 'fa-toggle-off text-gray-400'}"></i>
          </button>
        </td>
      </tr>
    `;
  }).join('');
}

 function displaySuppliers(suppliers) {
  console.log('Displaying Suppliers:', suppliers);
  const tbody = document.querySelector('#supplierTable tbody');
  tbody.innerHTML = suppliers.map(s => `
    <tr>
      <td>${s.DateAdded || ''}</td>
      <td>${s.SupplierID || ''}</td> <!-- Display Supplier ID -->
      <td>${s.SupplierName || ''}</td>
      <td>${s.ContactPersonName || ''}</td>
      <td>${s.ContactNumber || ''}</td>
      <td>${s.AddressLine1 || ''}</td>
      <td>${s.AddressLine2 || ''}</td>
      <td>${s.AddressLine3 || ''}</td>
      <td>${s.City || ''}</td>
      <td>${s.State || ''}</td>
      <td>${s.PINCode || ''}</td>
      <td>${s.GSTNo || ''}</td>
      <td>${s.EmailID || ''}</td>
      <td>${s.WhatsAppNo || ''}</td>
      <td>
        <button class="edit-btn" onclick='openEditSupplierModal(${JSON.stringify({
          id: s.SupplierID, // Ensure Supplier ID is used here
          supplierName: s.SupplierName,
          contactPersonName: s.ContactPersonName,
          contactNumber: s.ContactNumber,
          addressLine1: s.AddressLine1,
          addressLine2: s.AddressLine2,
          addressLine3: s.AddressLine3,
          city: s.City,
          state: s.State,
          pinCode: s.PINCode,
          gstNo: s.GSTNo,
          emailId: s.EmailID,
          whatsappNo: s.WhatsAppNo
        })})'>
          <i class="fas fa-edit"></i>
        </button>
      </td>
    </tr>
  `).join('');
}
  function displayWarehouses(warehouses) {
    console.log('Displaying Warehouses:', warehouses);
    const tbody = document.querySelector('#warehouseTable tbody');
    tbody.innerHTML = warehouses.map(w => `
      <tr>
        <td>${w.srNo || ''}</td>
        <td>${w.vendorName || ''}</td>
        <td>${w.location || ''}</td>
        <td>${w.managerName || ''}</td>
        <td>${w.addedOn || ''}</td>
        <td>
          <button class="edit-btn" onclick='openEditWarehouseModal(${JSON.stringify({
            id: w.srNo,
            vendorName: w.vendorName,
            location: w.location,
            managerName: w.managerName
          })})'>
            <i class="fas fa-edit"></i>
          </button>
        </td>
      </tr>
    `).join('');
  }

  function displayTransactions(transactions) {
    console.log('Displaying Transactions:', transactions);
    const tbody = document.querySelector('#transactionTable tbody');
    tbody.innerHTML = transactions.map(t => `<tr>${t.map(val => `<td>${val || ''}</td>`).join('')}</tr>`).join('');
  }



  function loadVendorsForSelect(selector, defaultValue = '') {
    console.log('Loading vendors for:', selector);
    google.script.run.withSuccessHandler(vendors => {
      console.log('Loaded Vendors:', vendors);
      const select = $(selector);
      select.html(`<option value="">${defaultValue}</option>`);
      vendors.forEach(v => {
        const option = `<option value="${v}" ${v === defaultValue ? 'selected' : ''}>${v}</option>`;
        select.append(option);
      });
      select.select2();
    }).withFailureHandler(error => {
      console.error('Failed to load vendors:', error);
    }).getVendorNames();
  }

  function loadManagersForSelect(selector, defaultText = 'Select Manager') {
    console.log('Loading managers for:', selector);
    google.script.run.withSuccessHandler(managers => {
      console.log('Loaded Managers:', managers);
      const select = $(selector);
      select.html(`<option value="">${defaultText}</option>`);
      managers.forEach(m => select.append(`<option value="${m}">${m}</option>`));
      select.select2();
    }).withFailureHandler(error => {
      console.error('Failed to load managers:', error);
    }).getManagerNames();
  }

  function loadLocationsForSelect(selector, defaultValue = '') {
    console.log('Loading locations for:', selector);
    google.script.run.withSuccessHandler(locations => {
      console.log('Loaded Locations:', locations);
      const select = $(selector);
      select.html(`<option value="">${defaultValue}</option>`);
      locations.forEach(loc => {
        select.append(`<option value="${loc}" ${loc === defaultValue ? 'selected' : ''}>${loc}</option>`);
      });
      select.select2();
    }).withFailureHandler(error => {
      console.error('Failed to load locations:', error);
    }).getLocationNames();
  }

  function loadWarehousesForSelect(selector, defaultValue = '') {
    console.log('Loading warehouses for:', selector);
    google.script.run.withSuccessHandler(warehouses => {
      console.log('Loaded Warehouses:', warehouses);
      const select = $(selector);
      select.html(`<option value="">${defaultValue}</option>`);
      warehouses.forEach(w => {
        const option = `<option value="${w.vendorName}" ${w.vendorName === defaultValue ? 'selected' : ''}>${w.vendorName}</option>`;
        select.append(option);
      });
      select.select2();
    }).withFailureHandler(error => {
      console.error('Failed to load warehouses:', error);
    }).getWarehouseData();
  }

  function loadSKUsForAdjustment(selector, defaultValue = '') {
    console.log('Loading SKUs for adjustment:', selector);
    google.script.run.withSuccessHandler(skus => {
      console.log('Loaded SKUs:', skus);
      const select = $(selector);
      select.html(`<option value="">${defaultValue}</option>`);
      skus.forEach(sku => {
        select.append(`<option value="${sku[0]}" ${sku[0] === defaultValue ? 'selected' : ''}>${sku[1]}</option>`);
      });
      select.select2();
    }).withFailureHandler(error => {
      console.error('Failed to load SKUs:', error);
    }).getSKUs();
  }

  async function handleAddSKU(e) {
    e.preventDefault();
    console.log('Adding SKU...');
    const formData = Object.fromEntries(new FormData(e.target));
    formData.status = 'Active';
    try {
      await google.script.run.withSuccessHandler(() => {
        Swal.fire({ icon: 'success', title: 'Success!', text: 'SKU added successfully', timer: 1500 });
        closeModal('addSKUModal');
        e.target.reset();
        loadSKUs();
      }).withFailureHandler(error => {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add SKU: ' + error.message });
        console.error('Failed to add SKU:', error);
      }).addSKU(formData);
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add SKU: ' + error.message });
      console.error('Failed to add SKU:', error);
    }
  }

async function handleEditSKU(e) {
  e.preventDefault();
  console.log('Editing SKU...');
  const formData = Object.fromEntries(new FormData(e.target));
  console.log('Form Data:', formData); // Debugging: Log the form data

  const changes = Object.keys(originalSKUData).reduce((acc, key) => {
    if (formData[key] !== originalSKUData[key]) {
      acc[key] = { old: originalSKUData[key], new: formData[key] };
    }
    return acc;
  }, {});

  const changesHTML = Object.entries(changes).map(([key, { old, new: newVal }]) => `
    <p><strong>${key.replace(/([A-Z])/g, ' $1').trim()}:</strong> ${old}  ${newVal}</p>
  `).join('');

  const confirmed = await Swal.fire({
    title: 'Confirm Changes',
    html: changesHTML,
    icon: 'info',
    showCancelButton: true,
    confirmButtonText: 'Yes, update it!',
    cancelButtonText: 'No, cancel!'
  });

  if (confirmed.isConfirmed) {
    const updateSKUButton = document.getElementById('updateSKUButton');
    if (updateSKUButton) {
      updateSKUButton.disabled = true;
    }
    const loadingSpinner = document.getElementById('loadingSpinner');
    if (loadingSpinner) {
      loadingSpinner.style.display = 'block';
    }

    try {
      await google.script.run.withSuccessHandler(() => {
        Swal.fire({ icon: 'success', title: 'Success!', text: 'SKU updated successfully', timer: 1500 });
        closeModal('editSKUModal');
        e.target.reset();
        loadSKUs();
      }).withFailureHandler(error => {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update SKU: ' + error.message });
        console.error('Failed to update SKU:', error);
      }).updateSKU(formData);
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update SKU: ' + error.message });
      console.error('Failed to update SKU:', error);
    } finally {
      if (updateSKUButton) {
        updateSKUButton.disabled = false;
      }
      if (loadingSpinner) {
        loadingSpinner.style.display = 'none';
      }
    }
  }
}
  async function handleAddSupplier(e) {
    e.preventDefault();
    console.log('Adding Supplier...');
    const formData = Object.fromEntries(new FormData(e.target));
    try {
      await google.script.run.withSuccessHandler(() => {
        Swal.fire({ icon: 'success', title: 'Success!', text: 'Supplier added successfully', timer: 1500 });
        closeModal('addSupplierModal');
        e.target.reset();
        loadSuppliers();
      }).withFailureHandler(error => {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add supplier: ' + error.message });
        console.error('Failed to add supplier:', error);
      }).addSupplier(formData);
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add supplier: ' + error.message });
      console.error('Failed to add supplier:', error);
    }
  }

  async function handleEditSupplier(e) {
  e.preventDefault();
  console.log('Editing Supplier...');
  const formData = Object.fromEntries(new FormData(e.target));
  console.log('Form Data:', formData); // Debugging: Log the form data
  try {
    await google.script.run.withSuccessHandler(() => {
      Swal.fire({ icon: 'success', title: 'Success!', text: 'Supplier updated successfully', timer: 1500 });
      closeModal('editSupplierModal');
      loadSuppliers();
    }).withFailureHandler(error => {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update supplier: ' + error.message });
      console.error('Failed to update supplier:', error);
    }).updateSupplier(formData);
  } catch (error) {
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update supplier: ' + error.message });
    console.error('Failed to update supplier:', error);
  }
}

function openEditSupplierModal(supplier) {
  console.log('Opening edit supplier modal:', supplier);
  const modal = document.getElementById('editSupplierModal');
  document.getElementById('editSupplierId').value = supplier.id; // Set Supplier ID
  document.getElementById('editVendorName').value = supplier.supplierName;
  document.getElementById('editContactPersonName').value = supplier.contactPersonName;
  document.getElementById('editContactNumber').value = supplier.contactNumber;
  document.getElementById('editAddressLine1').value = supplier.addressLine1;
  document.getElementById('editAddressLine2').value = supplier.addressLine2;
  document.getElementById('editAddressLine3').value = supplier.addressLine3;
  document.getElementById('editCity').value = supplier.city;
  document.getElementById('editState').value = supplier.state;
  document.getElementById('editPinCode').value = supplier.pinCode;
  document.getElementById('editGstNo').value = supplier.gstNo;
  document.getElementById('editEmailId').value = supplier.emailId;
  document.getElementById('editWhatsAppNo').value = supplier.whatsappNo;

  showModal('editSupplierModal');
}

  async function handleAddWarehouse(e) {
    e.preventDefault();
    console.log('Adding Warehouse...');
    const formData = Object.fromEntries(new FormData(e.target));
    try {
      await google.script.run.withSuccessHandler(() => {
        Swal.fire({ icon: 'success', title: 'Success!', text: 'Warehouse added successfully', timer: 1500 });
        closeModal('addWarehouseModal');
        e.target.reset();
        loadWarehouses();
      }).withFailureHandler(error => {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add warehouse: ' + error.message });
        console.error('Failed to add warehouse:', error);
      }).addWarehouse(formData);
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add warehouse: ' + error.message });
      console.error('Failed to add warehouse:', error);
    }
  }

  async function handleEditWarehouse(e) {
    e.preventDefault();
    console.log('Editing Warehouse...');
    const formData = Object.fromEntries(new FormData(e.target));
    try {
      await google.script.run.withSuccessHandler(() => {
        Swal.fire({ icon: 'success', title: 'Success!', text: 'Warehouse updated successfully', timer: 1500 });
        closeModal('editWarehouseModal');
        loadWarehouses();
      }).withFailureHandler(error => {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update warehouse: ' + error.message });
        console.error('Failed to update warehouse:', error);
      }).updateWarehouse(formData);
    } catch (error) {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update warehouse: ' + error.message });
      console.error('Failed to update warehouse:', error);
    }
  }

  async function handleAddAdjustment(e) {
  e.preventDefault();
  console.log('Adding Adjustment...');
  const formData = Object.fromEntries(new FormData(e.target));
  formData.transactionType = formData.type === 'in' ? 'Adjusted In' : 'Adjusted Out';
  delete formData.type;
  try {
    await google.script.run.withSuccessHandler(() => {
      Swal.fire({ icon: 'success', title: 'Success!', text: 'Adjustment added successfully', timer: 1500 });
      closeModal('addAdjustmentModal');
      e.target.reset();
      loadTransactions();
      loadSKUs();
      updateDashboard();
    }).withFailureHandler(error => {
      Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add adjustment: ' + error.message });
      console.error('Failed to add adjustment:', error);
    }).addStockAdjustment(formData);
  } catch (error) {
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to add adjustment: ' + error.message });
    console.error('Failed to add adjustment:', error);
  }
}

  

  function loadItemNamesForDatalist() {
  console.log('Loading item names for datalist...');
  google.script.run.withSuccessHandler(itemNames => {
    console.log('Loaded Item Names:', itemNames);
    const datalist = document.getElementById('itemNames');
    datalist.innerHTML = '';
    itemNames.forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      datalist.appendChild(option);
    });
  }).withFailureHandler(error => {
    console.error('Failed to load item names:', error);
  }).getItemNames();
}

function filterSKUs() {
    console.log('Filtering SKUs...');
    const skuId = document.getElementById('skuSearchInput').value.toLowerCase();
    const warehouse = document.getElementById('warehouseFilter').value.toLowerCase();
    const itemName = document.getElementById('itemSearchInput').value.toLowerCase();
    const status = document.getElementById('statusFilter').value.toLowerCase();
    const uom = document.getElementById('uomFilter').value.toLowerCase();

    let filteredSKUs = skuCache;

    if (skuId) {
        filteredSKUs = filteredSKUs.filter(sku => sku.sku && sku.sku.toLowerCase() === skuId);
    }
    if (warehouse) {
        filteredSKUs = filteredSKUs.filter(sku => sku.warehouse && sku.warehouse.toLowerCase() === warehouse);
    }
    if (itemName) {
        filteredSKUs = filteredSKUs.filter(sku => sku.itemName && sku.itemName.toLowerCase() === itemName);
    }
    if (status) {
        filteredSKUs = filteredSKUs.filter(sku => sku.status && sku.status.toLowerCase() === status);
    }
    if (uom) {
        filteredSKUs = filteredSKUs.filter(sku => sku.uom && sku.uom.toLowerCase() === uom);
    }

    console.log('Filtered SKUs:', filteredSKUs);
    displaySKUs(filteredSKUs);
}

  function applyTransactionFilters() {
    console.log('Applying transaction filters...');
    const sku = document.getElementById('transactionSearchInput').value.toLowerCase();
    const transactionType = document.getElementById('transactionTypeFilter').value;
    const startDate = document.getElementById('transactionStartDate').value;
    const endDate = document.getElementById('transactionEndDate').value;

    let filteredTransactions = transactionCache;

    if (sku) {
      filteredTransactions = filteredTransactions.filter(t => t[2].toLowerCase().includes(sku));
    }
    if (transactionType) {
      filteredTransactions = filteredTransactions.filter(t => t[5] === transactionType);
    }
    if (startDate && endDate) {
      const start = new Date(startDate);
      const end = new Date(endDate);
      filteredTransactions = filteredTransactions.filter(t => {
        const transactionDate = new Date(t[0]);
        return transactionDate >= start && transactionDate <= end;
      });
    }

    console.log('Filtered Transactions:', filteredTransactions);
    displayTransactions(filteredTransactions);
  }

function filterSuppliers() {
    console.log('Filtering Suppliers...');
    const supplierName = document.getElementById('supplierSearchInput').value.toLowerCase();
    const city = document.getElementById('cityFilter').value.toLowerCase();
    const state = document.getElementById('stateFilter').value.toLowerCase();

    let filteredSuppliers = supplierCache;

    if (supplierName) {
        filteredSuppliers = filteredSuppliers.filter(s => (s.SupplierName || '').toLowerCase() === supplierName);
    }
    if (city) {
        filteredSuppliers = filteredSuppliers.filter(s => (s.City || '').toLowerCase() === city);
    }
    if (state) {
        filteredSuppliers = filteredSuppliers.filter(s => (s.State || '').toLowerCase() === state);
    }

    console.log('Filtered Suppliers:', filteredSuppliers);
    displaySuppliers(filteredSuppliers);
}

  function filterWarehouses() {
    console.log('Filtering Warehouses...');
    const term = document.getElementById('warehouseSearchInput').value.toLowerCase();
    const manager = document.getElementById('managerFilter').value.toLowerCase();

    let filteredWarehouses = warehouseCache;

     if (term) {
        filteredWarehouses = filteredWarehouses.filter(w => w.vendorName && w.vendorName.toLowerCase() === term);
    }
    if (manager) {
        filteredWarehouses = filteredWarehouses.filter(w => w.managerName && w.managerName.toLowerCase() === manager);
    }

    console.log('Filtered Warehouses:', filteredWarehouses);
    displayWarehouses(filteredWarehouses);
  }

  function resetFilters() {
    console.log('Resetting filters...');
    document.getElementById('skuSearchInput').value = '';
    document.getElementById('warehouseFilter').value = '';
    document.getElementById('itemSearchInput').value = '';
     document.getElementById('uomFilter').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('supplierSearchInput').value = '';
    document.getElementById('transactionSearchInput').value = '';
    document.getElementById('transactionTypeFilter').value = '';
    document.getElementById('transactionStartDate').value = '';
    document.getElementById('transactionEndDate').value = '';
    document.getElementById('warehouseSearchInput').value = '';
    document.getElementById('managerFilter').value = '';

    displaySKUs(skuCache);
    displaySuppliers(supplierCache);
    displayTransactions(transactionCache);
    displayWarehouses(warehouseCache);
  }

  function resetTransactionFilters() {
    console.log('Resetting transaction filters...');
    document.getElementById('transactionStartDate').value = '';
    document.getElementById('transactionEndDate').value = '';
    document.getElementById('transactionSearchInput').value = '';
    document.getElementById('transactionTypeFilter').value = '';
    applyTransactionFilters();
  }

  function populateDropdowns() {
    console.log('Populating dropdowns...');
    loadVendorsForSelect('#vendor1', 'Select Vendor');
    loadVendorsForSelect('#vendor2', 'Select Vendor');
    loadVendorsForSelect('#vendor3', 'Select Vendor');
    loadVendorsForSelect('#vendor4', 'Select Vendor');
    loadVendorsForSelect('#vendor5', 'Select Vendor');
    loadVendorsForSelect('#editVendor1', 'Select Vendor');
    loadVendorsForSelect('#editVendor2', 'Select Vendor');
    loadVendorsForSelect('#editVendor3', 'Select Vendor');
    loadVendorsForSelect('#editVendor4', 'Select Vendor');
    loadVendorsForSelect('#editVendor5', 'Select Vendor');
    loadWarehousesForSelect('#warehouse', 'Select Warehouse');
    loadWarehousesForSelect('#editWarehouse', 'Select Warehouse');
    loadManagersForSelect('#managerFilter', 'All Managers');
    loadLocationsForSelect('#location', 'Select Location');
    loadLocationsForSelect('#editLocation', 'Select Location');
     loadVendorsForDatalist('#vendors');
    loadWarehousesForDatalist('#warehouses');
    loadLocationsForDatalist('#locations');

    const statusFilter = document.getElementById('statusFilter');
    statusFilter.innerHTML = `
      <option value="">All Status</option>
      <option value="Active">Active</option>
      <option value="Inactive">Inactive</option>
    `;
  }
function loadVendorsForDatalist(selector) {
  console.log('Loading vendors for:', selector);
  google.script.run.withSuccessHandler(vendors => {
    console.log('Loaded Vendors:', vendors);
    const datalist = document.querySelector(selector);
    datalist.innerHTML = '';
    vendors.forEach(v => {
      const option = document.createElement('option');
      option.value = v;
      datalist.appendChild(option);
    });
  }).withFailureHandler(error => {
    console.error('Failed to load vendors:', error);
  }).getVendorNames();
}

function loadWarehousesForDatalist(selector) {
  console.log('Loading warehouses for:', selector);
  google.script.run.withSuccessHandler(warehouses => {
    console.log('Loaded Warehouses:', warehouses);
    const datalist = document.querySelector(selector);
    datalist.innerHTML = '';
    warehouses.forEach(w => {
      const option = document.createElement('option');
      option.value = w.vendorName;
      datalist.appendChild(option);
    });
  }).withFailureHandler(error => {
    console.error('Failed to load warehouses:', error);
  }).getWarehouseData();
}

function loadLocationsForDatalist(selector) {
  console.log('Loading locations for:', selector);
  google.script.run.withSuccessHandler(locations => {
    console.log('Loaded Locations:', locations);
    const datalist = document.querySelector(selector);
    datalist.innerHTML = '';
    locations.forEach(loc => {
      const option = document.createElement('option');
      option.value = loc;
      datalist.appendChild(option);
    });
  }).withFailureHandler(error => {
    console.error('Failed to load locations:', error);
  }).getLocationNames();
}
 function openEditSKUModal(sku) {
  console.log('Opening edit SKU modal:', sku);
  const modal = document.getElementById('editSKUModal');
  document.getElementById('editSKUId').value = sku.id;
  document.getElementById('editItemName').value = sku.itemName;
  document.getElementById('editSKU').value = sku.sku;
  document.getElementById('editUom').value = sku.uom;
  document.getElementById('editMinLvl').value = sku.minLvl;
  document.getElementById('editMaxLvl').value = sku.maxLvl;
  document.getElementById('editReorderQty').value = sku.reorderQty;
  document.getElementById('editOpeningStock').value = sku.openingStock;
  document.getElementById('editPrice').value = sku.price;

  loadWarehousesForSelect('#editWarehouse', sku.warehouse);
  loadVendorsForSelect('#editVendor1', sku.vendor1);
  loadVendorsForSelect('#editVendor2', sku.vendor2);
  loadVendorsForSelect('#editVendor3', sku.vendor3);
  loadVendorsForSelect('#editVendor4', sku.vendor4);
  loadVendorsForSelect('#editVendor5', sku.vendor5);
  loadLocationsForSelect('#editLocation', sku.location);

  originalSKUData = { ...sku };

  document.querySelectorAll('#editSKUForm input, #editSKUForm select').forEach(input => {
    input.addEventListener('change', checkForChanges);
  });

  showModal('editSKUModal');
}
function checkForChanges() {
  const form = document.getElementById('editSKUForm');
  const formData = Object.fromEntries(new FormData(form));
  const hasChanges = Object.keys(originalSKUData).some(key => formData[key] !== originalSKUData[key]);
  document.getElementById('updateSKUButton').disabled = !hasChanges;
}



  function openEditWarehouseModal(warehouse) {
    console.log('Opening edit warehouse modal:', warehouse);
    const modal = document.getElementById('editWarehouseModal');
    document.getElementById('editWarehouseId').value = warehouse.id;
    document.getElementById('editWarehouseVendorName').value = warehouse.vendorName;
    document.getElementById('editWarehouseLocation').value = warehouse.location;
    document.getElementById('editWarehouseManagerName').value = warehouse.managerName;

    showModal('editWarehouseModal');
  }

  function sortTable(header, tableId, isNumeric = false, columnIndex = null) {
    console.log('Sorting table:', tableId);
    const table = document.getElementById(tableId);
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const th = header;
    const index = columnIndex !== null ? columnIndex : Array.from(th.parentNode.children).indexOf(th);

    table.querySelectorAll('th').forEach(h => h.classList.remove('sort-asc', 'sort-desc'));

    let direction = 'asc';
    if (th.classList.contains('sort-asc')) {
      direction = 'desc';
    } else if (th.classList.contains('sort-desc')) {
      direction = 'asc';
    }

    th.classList.add(`sort-${direction}`);

    rows.sort((a, b) => {
      const aCell = a.cells[index].textContent.trim();
      const bCell = b.cells[index].textContent.trim();

      if (isNumeric) {
        const aNum = parseFloat(aCell) || 0;
        const bNum = parseFloat(bCell) || 0;
        return direction === 'asc' ? aNum - bNum : bNum - aNum;
      } else {
        return direction === 'asc' ? aCell.localeCompare(bCell) : bCell.localeCompare(aCell);
      }
    });

    rows.forEach(row => tbody.appendChild(row));
  }

  function exportTable(tableId, format) {
    console.log('Exporting table:', tableId, 'format:', format);
    const table = document.getElementById(tableId);
    const rows = table.querySelectorAll('tbody tr');
    const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim()).slice(0, -1);
    const data = Array.from(rows).map(row => {
      return Array.from(row.querySelectorAll('td')).slice(0, -1).map(td => td.textContent.trim());
    });

    if (format === 'csv') {
      const csvContent = [headers, ...data].map(row => row.join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${tableId}_export.csv`;
      a.click();
      URL.revokeObjectURL(url);
    } else if (format === 'excel') {
      const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
      XLSX.writeFile(wb, `${tableId}_export.xlsx`);
    } else if (format === 'pdf') {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.autoTable({
        head: [headers],
        body: data,
        theme: 'grid',
        styles: { fontSize: 8 },
      });
      doc.save(`${tableId}_export.pdf`);
    }
  }

  function downloadSKUTemplate() {
    console.log('Downloading SKU template...');
    const headers = ['Item Name', 'UOM', 'Min Lvl', 'Max Lvl', 'Reorder Qty', 'Warehouse', 'Location', 'Opening Stock', 'Price', 'V1', 'V2', 'V3', 'V4', 'V5', 'SKU'];
    const csvContent = headers.join(',') + '\n';
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sku_template.csv';
    a.click();
    URL.revokeObjectURL(url);
  }

  function downloadTransactionTemplate() {
    console.log('Downloading transaction template...');
    const headers = ['SKU Name', 'Qty', 'Adjustment Type'];
    const csvContent = headers.join(',') + '\n';
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'transaction_template.csv';
    a.click();
    URL.revokeObjectURL(url);
  }

  function uploadSKUCSV() {
    console.log('Uploading SKU CSV...');
    const fileInput = document.getElementById('skuCSVInput');
    const file = fileInput.files[0];
    if (!file) {
      console.error('No file selected.');
      Swal.fire({ icon: 'error', title: 'Error', text: 'Please select a CSV file.' });
      return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        console.log('Reading CSV file...');
        const text = e.target.result;
        const rows = text.split('\n').map(row => row.split(',').map(cell => cell.trim())).filter(row => row.length > 1);
        if (rows.length === 0) {
          console.error('CSV is empty.');
          Swal.fire({ icon: 'error', title: 'Error', text: 'CSV file is empty.' });
          return;
        }

        const headers = rows.shift();
        const expectedHeaders = ['Item Name', 'UOM', 'Min Lvl', 'Max Lvl', 'Reorder Qty', 'Warehouse', 'Location', 'Opening Stock', 'Price', 'V1', 'V2', 'V3', 'V4', 'V5', 'SKU'];

        if (!headers.every((h, i) => h === expectedHeaders[i])) {
          console.error('Invalid CSV headers:', headers);
          Swal.fire({ icon: 'error', title: 'Error', text: 'Invalid CSV format. Please use the provided template.' });
          return;
        }

        console.log('Sending SKU data to server:', rows);
        google.script.run.withSuccessHandler(result => {
          console.log('Server response:', result);
          if (result.status === 'success') {
            Swal.fire({ icon: 'success', title: 'Success!', text: result.message, timer: 1500 });
            closeModal('skuImportModal');
            loadSKUs();
            updateDashboard();
          } else {
            console.error('Server error:', result.message);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Error: ' + result.message });
          }
        }).withFailureHandler(error => {
          console.error('Server call failed:', error);
          Swal.fire({ icon: 'error', title: 'Error', text: 'Server error: ' + error.message });
        }).handleSKUImport(rows);
      } catch (error) {
        console.error('Error processing CSV:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Error processing CSV: ' + error.message });
      }
    };
    reader.onerror = function () {
      console.error('Error reading file.');
      Swal.fire({ icon: 'error', title: 'Error', text: 'Error reading CSV file.' });
    };
    reader.readAsText(file);
  }

  function uploadTransactionCSV() {
    console.log('Uploading transaction CSV...');
    const fileInput = document.getElementById('transactionCSVInput');
    const file = fileInput.files[0];
    if (!file) {
      console.error('No file selected.');
      Swal.fire({ icon: 'error', title: 'Error', text: 'Please select a CSV file.' });
      return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        console.log('Reading CSV file...');
        const text = e.target.result;
        const rows = text.split('\n').map(row => row.split(',').map(cell => cell.trim())).filter(row => row.length > 1);
        if (rows.length === 0) {
          console.error('CSV is empty.');
          Swal.fire({ icon: 'error', title: 'Error', text: 'CSV file is empty.' });
          return;
        }

        const headers = rows.shift();
        const expectedHeaders = ['SKU Name', 'Qty', 'Adjustment Type'];

        if (!headers.every((h, i) => h === expectedHeaders[i])) {
          console.error('Invalid CSV headers:', headers);
          Swal.fire({ icon: 'error', title: 'Error', text: 'Invalid CSV format. Please use the provided template.' });
          return;
        }

        const validTypes = ['Adjusted In', 'Adjusted Out', 'Sale', 'Purchase'];
        const invalidRows = rows.filter(row => row[2] && !validTypes.includes(row[2]));
        if (invalidRows.length > 0) {
          console.error('Invalid Adjustment Types:', invalidRows);
          Swal.fire({ icon: 'error', title: 'Error', text: 'Invalid Adjustment Type. Must be one of: ' + validTypes.join(', ') });
          return;
        }

        console.log('Sending transaction data to server:', rows);
        google.script.run.withSuccessHandler(result => {
          console.log('Server response:', result);
          if (result.status === 'success') {
            Swal.fire({ icon: 'success', title: 'Success!', text: result.message, timer: 1500 });
            closeModal('transactionImportModal');
            loadTransactions();
            loadSKUs();
            updateDashboard();
          } else {
            console.error('Server error:', result.message);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Error: ' + result.message });
          }
        }).withFailureHandler(error => {
          console.error('Server call failed:', error);
          Swal.fire({ icon: 'error', title: 'Error', text: 'Server error: ' + error.message });
        }).handleTransactionImport(rows);
      } catch (error) {
        console.error('Error processing CSV:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Error processing CSV: ' + error.message });
      }
    };
    reader.onerror = function () {
      console.error('Error reading file.');
      Swal.fire({ icon: 'error', title: 'Error', text: 'Error reading CSV file.' });
    };
    reader.readAsText(file);
  }

function updateDashboard() {
  console.log('Updating dashboard...');
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  google.script.run.withSuccessHandler(data => {
    console.log('Dashboard Data:', data);

    // Update total counts
    document.getElementById('totalSKUs').textContent = data.totalSKUs;
    document.getElementById('totalTransactions').textContent = data.totalTransactions;
    document.getElementById('totalVendors').textContent = data.totalVendors;
    document.getElementById('totalWarehouses').textContent = data.totalWarehouses;
    document.getElementById('inventoryValuation').textContent = data.inventoryValuation;

    // Update transactions by type chart
    if (stockMovementChart) stockMovementChart.destroy();
    stockMovementChart = new Chart(document.getElementById('transactionsByTypeChart'), {
      type: 'bar',
      data: {
        labels: Object.keys(data.transactionsByType),
        datasets: [{
          label: 'Transactions by Type',
          data: Object.values(data.transactionsByType),
          backgroundColor: ['#4f46e5', '#34d399', '#ec4899', '#fbbf24'],
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: false } },
        maintainAspectRatio: true
      }
    });

    // Update low stock table
    const lowStockTbody = document.querySelector('#lowStockTable tbody');
    lowStockTbody.innerHTML = data.lowStock.map(row => `
      <tr class="low-stock">
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>${row[2]}</td>
        <td>${row[3]}</td>
      </tr>
    `).join('');

    // Update over stock table
    const overStockTbody = document.querySelector('#overStockTable tbody');
    overStockTbody.innerHTML = data.overStock.map(row => `
      <tr>
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>${row[2]}</td>
        <td>${row[3]}</td>
      </tr>
    `).join('');

    // Update detailed transaction summary table
    const detailedTransactionSummaryTbody = document.querySelector('#detailedTransactionSummaryTable tbody');
    detailedTransactionSummaryTbody.innerHTML = data.transactionSummary.map(row => `
      <tr>
        <td>${row.itemName}</td>
        <td>${row.totalTransactions}</td>
        <td>${row.purchase}</td>
        <td>${row.sale}</td>
        <td>${row.adjustedIn}</td>
        <td>${row.adjustedOut}</td>
      </tr>
    `).join('');

    // Update inventory by warehouse chart
    if (inventoryByWarehouseChart) inventoryByWarehouseChart.destroy();
    const ctx = document.getElementById('inventoryByWarehouseChart').getContext('2d');
    inventoryByWarehouseChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: Object.keys(data.inventoryByWarehouse),
        datasets: [{
          label: 'Inventory by Warehouse',
          data: Object.values(data.inventoryByWarehouse),
          backgroundColor: ['#4f46e5', '#34d399', '#ec4899', '#fbbf24'],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            mode: 'index',
            intersect: false,
          },
        },
      },
    });

    // Extract months and values for Growth and Movement data
    const growthMonths = data.inventoryGrowth ? data.inventoryGrowth.map(item => item.month) : [];
    const growthValues = data.inventoryGrowth ? data.inventoryGrowth.map(item => item.value) : [];
    
    const movementMonths = data.stockMovements ? data.stockMovements.map(item => item.month) : [];
    const movementValues = data.stockMovements ? data.stockMovements.map(item => item.value) : [];

    console.log('Growth Months:', growthMonths);
    console.log('Growth Values:', growthValues);
    console.log('Movement Months:', movementMonths);
    console.log('Movement Values:', movementValues);

    // Growth Chart Variations
    
    // 1. Line Chart for Growth
    if (window.growthLineChart) window.growthLineChart.destroy();
    window.growthLineChart = new Chart(document.getElementById('growthChart'), {
      type: 'line',
      data: {
        labels: growthMonths,
        datasets: [{
          label: 'Inventory Growth',
          data: growthValues,
          borderColor: '#32a852',
          backgroundColor: 'rgba(50, 168, 78, 0.1)',
          tension: 0.4,
          fill: true,
          borderWidth: 2,
          pointBackgroundColor: '#32a852',
          pointRadius: 4
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Inventory Growth (Line Chart)'
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              label: function(context) {
                return `Growth: ${context.parsed.y.toFixed(2)}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Units'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Month'
            }
          }
        }
      }
    });

  }).withFailureHandler(error => {
    console.error('Failed to update dashboard:', error);
    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to update dashboard: ' + error.message });
  }).getDashboardData(startDate, endDate);
}
 

  function showSection(sectionId) {
    console.log('Showing section:', sectionId);
    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
      if (item.getAttribute('onclick').includes(sectionId)) {
        item.classList.add('active');
      }
    });
  }

  function openModal(modalId) {
  console.log('Showing modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.style.display = 'flex';
    setTimeout(() => {
      modal.classList.add('show');
      modal.querySelector('.modal-content').classList.add('show');
    }, 10);
  } else {
    console.error('Modal not found:', modalId);
    Swal.fire({ icon: 'error', title: 'Error', text: 'Modal not found' });
  }
}
 async function fetchPincodeDetails() {
    const pinCode = document.getElementById('pinCode').value;
    if (pinCode.length === 6) {
        try {
            const response = await fetch(`https://api.postalpincode.in/pincode/${pinCode}`);
            const data = await response.json();
            if (data[0].Status === 'Success') {
                const postOffice = data[0].PostOffice[0];
                document.getElementById('city').value = postOffice.Block || postOffice.Name; // Use Block or Name as city
                document.getElementById('state').value = postOffice.State;
            } else {
                Swal.fire({ icon: 'error', title: 'Error', text: 'Invalid PIN Code' });
                document.getElementById('city').value = '';
                document.getElementById('state').value = '';
            }
        } catch (error) {
            console.error('Error fetching PIN code details:', error);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to fetch PIN code details' });
            document.getElementById('city').value = '';
            document.getElementById('state').value = '';
        }
    } else {
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
    }
}

async function fetchPincodeDetailsForEdit() {
    const pinCode = document.getElementById('editPinCode').value;
    if (pinCode.length === 6) {
        try {
            const response = await fetch(`https://api.postalpincode.in/pincode/${pinCode}`);
            const data = await response.json();
            if (data[0].Status === 'Success') {
                const postOffice = data[0].PostOffice[0];
                document.getElementById('editCity').value = postOffice.Block || postOffice.Name; // Use Block or Name as city
                document.getElementById('editState').value = postOffice.State;
            } else {
                Swal.fire({ icon: 'error', title: 'Error', text: 'Invalid PIN Code' });
                document.getElementById('editCity').value = '';
                document.getElementById('editState').value = '';
            }
        } catch (error) {
            console.error('Error fetching PIN code details:', error);
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to fetch PIN code details' });
            document.getElementById('editCity').value = '';
            document.getElementById('editState').value = '';
        }
    } else {
        document.getElementById('editCity').value = '';
        document.getElementById('editState').value = '';
    }
}

    // Function to generate and display the Stock Aging Report
function generateStockAgingReport() {
    console.log('Generating Stock Aging Report...');
    google.script.run.withSuccessHandler(data => {
        console.log('Stock Aging Report Data:', data);
        displayStockAgingReport(data);
    }).withFailureHandler(error => {
        console.error('Failed to generate Stock Aging Report:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to generate Stock Aging Report: ' + error.message });
    }).getStockAgingReport();
}

function displayStockAgingReport(reportData) {
    console.log('Displaying Stock Aging Report:', reportData);
    const tbody = document.getElementById('stockAgingReportTableBody');
    tbody.innerHTML = reportData.map(row => `
        <tr>
            <td>${row.id}</td>
            <td>${row.itemName}</td>
            <td>${row.sku}</td>
            <td>${row.addedOn}</td>
            <td>${row.daysSinceAdded}</td>
            <td>${row.lastTransactionOn || 'N/A'}</td>
            <td>${row.daysSinceLastTransaction || 'N/A'}</td>
            <td>${row.totalTransactions}</td>
        </tr>
    `).join('');

    document.getElementById('exportButtonsContainer').style.display = 'flex';
}
function generateSalesDispatchReport() {
    console.log('Generating Sales Dispatch Report...');
    google.script.run.withSuccessHandler(data => {
        console.log('Sales Dispatch Report Data:', data);
        displaySalesDispatchReport(data);
    }).withFailureHandler(error => {
        console.error('Failed to generate Sales Dispatch Report:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to generate Sales Dispatch Report: ' + error.message });
    }).getSalesDispatchReport();
}

function displaySalesDispatchReport(reportData) {
    console.log('Displaying Sales Dispatch Report:', reportData);
    const tbody = document.getElementById('salesDispatchReportTableBody');
    tbody.innerHTML = reportData.map(row => `
        <tr>
            <td>${row.salesOrder}</td>
            <td>${row.timestamp}</td>
            <td>${row.itemName}</td>
            <td>${row.sku}</td>
            <td>${row.quantity}</td>
            <td>${row.dispatchQuantity}</td>
            <td>${row.remainingQuantity}</td>
            <td>${row.dispatchDate}</td>
            <td>${row.status}</td>
        </tr>
    `).join('');
}

function generateSalesReturnReport() {
    console.log('Generating Sales Return Report...');
    google.script.run.withSuccessHandler(data => {
        console.log('Sales Return Report Data:', data);
        displaySalesReturnReport(data);
    }).withFailureHandler(error => {
        console.error('Failed to generate Sales Return Report:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to generate Sales Return Report: ' + error.message });
    }).getSalesReturnReport();
}

function displaySalesReturnReport(reportData) {
    console.log('Displaying Sales Return Report:', reportData);
    const tbody = document.getElementById('salesReturnReportTableBody');
    tbody.innerHTML = reportData.map(row => `
        <tr>
            <td>${row.returnId}</td>
            <td>${row.orderId}</td>
            <td>${row.customerName}</td>
            <td>${row.itemName}</td>
            <td>${row.sku}</td>
            <td>${row.remainingUnits}</td>
            <td>${row.dispatchUnits}</td>
            <td>${row.returnUnits}</td>
            <td>${row.remark}</td>
            <td>${row.returnDate}</td>
            <td>${row.status}</td>
            <td>${row.returnAction}</td>
            <td>${row.timestamp}</td>
        </tr>
    `).join('');
}
function applySalesDispatchFilters() {
    console.log('Applying Sales Dispatch filters...');
    const salesOrder = document.getElementById('salesOrderFilter').value.toLowerCase();
    const itemName = document.getElementById('itemNameDispatchFilter').value.toLowerCase();
    const sku = document.getElementById('skuDispatchFilter').value.toLowerCase();
    const status = document.getElementById('statusDispatchFilter').value;
    const startDate = document.getElementById('dispatchStartDate').value;
    const endDate = document.getElementById('dispatchEndDate').value;

    let filteredData = salesDispatchData;

 if (salesOrder) {
        filteredData = filteredData.filter(row => (row.salesOrder || '').toLowerCase() === salesOrder);
    }
    if (itemName) {
        filteredData = filteredData.filter(row => (row.itemName || '').toLowerCase() === itemName);
    }
    if (sku) {
        filteredData = filteredData.filter(row => (row.sku || '').toLowerCase() === sku);
    }
    if (status) {
        filteredData = filteredData.filter(row => (row.status || '') === status);
    }
    if (startDate && endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        filteredData = filteredData.filter(row => {
            const transactionDate = new Date(row.timestamp);
            return transactionDate >= start && transactionDate <= end;
        });
    }
    console.log('Filtered Sales Dispatch Data:', filteredData);
    displaySalesDispatchReport(filteredData);
}

function resetSalesDispatchFilters() {
    console.log('Resetting Sales Dispatch filters...');
    document.getElementById('salesOrderFilter').value = '';
    document.getElementById('itemNameDispatchFilter').value = '';
    document.getElementById('skuDispatchFilter').value = '';
    document.getElementById('statusDispatchFilter').value = '';
    document.getElementById('dispatchStartDate').value = '';
    document.getElementById('dispatchEndDate').value = '';
    applySalesDispatchFilters();
}

function applySalesReturnFilters() {
    console.log('Applying Sales Return filters...');
    const returnId = document.getElementById('returnIdFilter').value.toLowerCase();
    const orderId = document.getElementById('orderIdFilter').value.toLowerCase();
    const customerName = document.getElementById('customerNameFilter').value.toLowerCase();
    const itemName = document.getElementById('itemNameReturnFilter').value.toLowerCase();
    const sku = document.getElementById('skuReturnFilter').value.toLowerCase();
    const status = document.getElementById('statusReturnFilter').value;
    const startDate = document.getElementById('returnStartDate').value;
    const endDate = document.getElementById('returnEndDate').value;

    let filteredData = salesReturnData;

    if (returnId) {
        filteredData = filteredData.filter(row => (row.returnId || '').toLowerCase() === returnId);
    }
    if (orderId) {
        filteredData = filteredData.filter(row => (row.orderId || '').toLowerCase() === orderId);
    }
    if (customerName) {
        filteredData = filteredData.filter(row => (row.customerName || '').toLowerCase() === customerName);
    }
    if (itemName) {
        filteredData = filteredData.filter(row => (row.itemName || '').toLowerCase() === itemName);
    }
    if (sku) {
        filteredData = filteredData.filter(row => (row.sku || '').toLowerCase() === sku);
    }
    if (status) {
        filteredData = filteredData.filter(row => (row.status || '') === status);
    }
    if (startDate && endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        filteredData = filteredData.filter(row => {
            const returnDate = new Date(row.returnDate);
            return returnDate >= start && returnDate <= end;
        });
    }

    console.log('Filtered Sales Return Data:', filteredData);
    displaySalesReturnReport(filteredData);
}

function resetSalesReturnFilters() {
    console.log('Resetting Sales Return filters...');
    document.getElementById('returnIdFilter').value = '';
    document.getElementById('orderIdFilter').value = '';
    document.getElementById('customerNameFilter').value = '';
    document.getElementById('itemNameReturnFilter').value = '';
    document.getElementById('skuReturnFilter').value = '';
    document.getElementById('statusReturnFilter').value = '';
    document.getElementById('returnStartDate').value = '';
    document.getElementById('returnEndDate').value = '';
    applySalesReturnFilters();
}

// Event listeners for generating reports
document.addEventListener('DOMContentLoaded', () => {
    // Existing DOMContentLoaded code...

    // Event listener for generating Stock Aging Report
    document.getElementById('generateStockAgingReportButton').addEventListener('click', generateStockAgingReport);

    // Event listener for generating Sales Dispatch Report
    document.getElementById('generateSalesDispatchReportButton').addEventListener('click', generateSalesDispatchReport);

    // Event listener for generating Sales Return Report
    document.getElementById('generateSalesReturnReportButton').addEventListener('click', generateSalesReturnReport);
});
let salesDispatchData = [];
let salesReturnData = [];

function loadSalesDispatchData() {
    console.log('Loading Sales Dispatch Data...');
    google.script.run.withSuccessHandler(data => {
        console.log('Loaded Sales Dispatch Data:', data);
        salesDispatchData = data;
        displaySalesDispatchReport(salesDispatchData);
    }).withFailureHandler(error => {
        console.error('Failed to load Sales Dispatch Data:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to load Sales Dispatch Data: ' + error.message });
    }).getSalesDispatchReport();
}

function loadSalesReturnData() {
    console.log('Loading Sales Return Data...');
    google.script.run.withSuccessHandler(data => {
        console.log('Loaded Sales Return Data:', data);
        salesReturnData = data;
        displaySalesReturnReport(salesReturnData);
    }).withFailureHandler(error => {
        console.error('Failed to load Sales Return Data:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to load Sales Return Data: ' + error.message });
    }).getSalesReturnReport();
}

// Event listeners for generating reports
document.addEventListener('DOMContentLoaded', () => {
    // Existing DOMContentLoaded code...

    // Event listener for generating Stock Aging Report
    document.getElementById('generateStockAgingReportButton').addEventListener('click', generateStockAgingReport);

    // Event listener for generating Sales Dispatch Report
    document.getElementById('generateSalesDispatchReportButton').addEventListener('click', () => {
        loadSalesDispatchData();
        document.getElementById('salesDispatchReportContainer').style.display = 'block';
        document.getElementById('salesReturnReportContainer').style.display = 'none';
        document.getElementById('stockAgingReportContainer').style.display = 'none';
    });

    // Event listener for generating Sales Return Report
    document.getElementById('generateSalesReturnReportButton').addEventListener('click', () => {
        loadSalesReturnData();
        document.getElementById('salesReturnReportContainer').style.display = 'block';
        document.getElementById('salesDispatchReportContainer').style.display = 'none';
        document.getElementById('stockAgingReportContainer').style.display = 'none';
    });
});
// Event listener for generating the Stock Aging Report
document.addEventListener('DOMContentLoaded', () => {
    // Existing DOMContentLoaded code...

    // Event listener for generating Stock Aging Report
    document.getElementById('generateStockAgingReportButton').addEventListener('click', generateStockAgingReport);
});
let skuVendorMappingData = [];
let originalVendorMappingData = {};

function loadSKUsForVendorMapping() {
    console.log('Loading SKUs for Vendor Mapping...');
    google.script.run.withSuccessHandler(data => {
        console.log('Loaded SKUs for Vendor Mapping:', data);
        skuVendorMappingData = data;
        originalVendorMappingData = JSON.parse(JSON.stringify(data)); // Deep copy
        displaySKUsForVendorMapping(skuVendorMappingData);
    }).withFailureHandler(error => {
        console.error('Failed to load SKUs for Vendor Mapping:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to load SKUs for Vendor Mapping: ' + error.message });
    }).getSKUs();
}

function displaySKUsForVendorMapping(skus) {
    console.log('Displaying SKUs for Vendor Mapping:', skus);
    const tbody = document.querySelector('#skuVendorMappingTableBody');
    if (!skus || skus.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">No data available</td></tr>';
        return;
    }

    const rows = skus.map(sku => `
        <tr>
            <td>${sku.id}</td>
            <td>${sku.itemName}</td>
            <td>${sku.sku}</td>
            <td>
                <input list="vendors" data-sku="${sku.sku}" data-vendor="V1" value="${sku.vendor1 || ''}" class="vendor-input">
                <datalist id="vendors">
                    <!-- Options will be populated dynamically -->
                </datalist>
            </td>
            <td>
                <input list="vendors" data-sku="${sku.sku}" data-vendor="V2" value="${sku.vendor2 || ''}" class="vendor-input">
                <datalist id="vendors">
                    <!-- Options will be populated dynamically -->
                </datalist>
            </td>
            <td>
                <input list="vendors" data-sku="${sku.sku}" data-vendor="V3" value="${sku.vendor3 || ''}" class="vendor-input">
                <datalist id="vendors">
                    <!-- Options will be populated dynamically -->
                </datalist>
            </td>
            <td>
                <input list="vendors" data-sku="${sku.sku}" data-vendor="V4" value="${sku.vendor4 || ''}" class="vendor-input">
                <datalist id="vendors">
                    <!-- Options will be populated dynamically -->
                </datalist>
            </td>
            <td>
                <input list="vendors" data-sku="${sku.sku}" data-vendor="V5" value="${sku.vendor5 || ''}" class="vendor-input">
                <datalist id="vendors">
                    <!-- Options will be populated dynamically -->
                </datalist>
            </td>
        </tr>
    `).join('');

    tbody.innerHTML = rows;

    // Populate vendor options for each dropdown
    populateVendorOptions()
        .then(options => {
            const datalists = document.querySelectorAll('#skuVendorMappingTable datalist');
            datalists.forEach(datalist => {
                datalist.innerHTML = options;
            });
        })
        .catch(error => {
            console.error('Error populating vendor options:', error);
        });
}

function populateVendorOptions() {
    return new Promise((resolve, reject) => {
        google.script.run.withSuccessHandler(vendors => {
            console.log('Loaded Vendors:', vendors);
            const options = vendors.map(vendor => `<option value="${vendor}">${vendor}</option>`).join('');
            resolve(options);
        }).withFailureHandler(error => {
            console.error('Failed to load vendors:', error);
            reject('');
        }).getVendorNames();
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // Existing DOMContentLoaded code...
    
    // Load SKUs for Vendor Mapping on page load
    loadSKUsForVendorMapping();

    // Event listener for vendor selects
    document.addEventListener('change', function(event) {
        if (event.target.classList.contains('vendor-input')) {
            const sku = event.target.getAttribute('data-sku');
            const vendorKey = event.target.getAttribute('data-vendor');
            const newValue = event.target.value;

            skuVendorMappingData.forEach(skuObj => {
                if (skuObj.sku === sku) {
                    skuObj[vendorKey === 'V1' ? 'vendor1' : vendorKey === 'V2' ? 'vendor2' : vendorKey === 'V3' ? 'vendor3' : vendorKey === 'V4' ? 'vendor4' : 'vendor5'] = newValue;
                }
            });
        }
    });
});
function selectedVendorOption(selectedVendor) {
    return selectedVendor ? `<option value="${selectedVendor}" selected>${selectedVendor}</option>` : '';
}


function filterSKUsForVendorMapping() {
    console.log('Filtering SKUs for Vendor Mapping...');
    const skuId = document.getElementById('skuSearchInputMapping').value.toLowerCase();
    const itemName = document.getElementById('itemSearchInputMapping').value.toLowerCase();

    let filteredSKUs = skuVendorMappingData;

      if (skuId) {
        filteredSKUs = filteredSKUs.filter(sku => String(sku.sku).toLowerCase() === skuId);
    }
    if (itemName) {
        filteredSKUs = filteredSKUs.filter(sku => sku.itemName.toLowerCase() === itemName);
    }


    console.log('Filtered SKUs:', filteredSKUs);
    displaySKUsForVendorMapping(filteredSKUs);
}

function resetVendorMappingFilters() {
    console.log('Resetting Vendor Mapping filters...');
    document.getElementById('skuSearchInputMapping').value = '';
    document.getElementById('itemSearchInputMapping').value = '';
    filterSKUsForVendorMapping();
}
function confirmVendorMappings() {
    console.log('Confirming Vendor Mappings...');
    const changes = skuVendorMappingData.filter(sku => {
        return originalVendorMappingData.some(originalSku => originalSku.sku === sku.sku && (
            originalSku.vendor1 !== sku.vendor1 ||
            originalSku.vendor2 !== sku.vendor2 ||
            originalSku.vendor3 !== sku.vendor3 ||
            originalSku.vendor4 !== sku.vendor4 ||
            originalSku.vendor5 !== sku.vendor5
        ));
    });

    if (changes.length === 0) {
        Swal.fire({ icon: 'info', title: 'No Changes', text: 'No changes detected.' });
        return;
    }

    const changesHTML = changes.map(sku => {
        const originalSku = originalVendorMappingData.find(osku => osku.sku === sku.sku);
        const vendorChanges = [
            { label: 'Vendor 1', original: originalSku.vendor1, new: sku.vendor1 },
            { label: 'Vendor 2', original: originalSku.vendor2, new: sku.vendor2 },
            { label: 'Vendor 3', original: originalSku.vendor3, new: sku.vendor3 },
            { label: 'Vendor 4', original: originalSku.vendor4, new: sku.vendor4 },
            { label: 'Vendor 5', original: originalSku.vendor5, new: sku.vendor5 }
        ].filter(change => change.original !== change.new);

        const vendorChangesHTML = vendorChanges.map(change => `
            <p><strong>${change.label}:</strong> ${change.original}  ${change.new}</p>
        `).join('');

        return `
            <p><strong>ID:</strong> ${sku.id}</p>
            <p><strong>Item Name:</strong> ${sku.itemName}</p>
            <p><strong>SKU:</strong> ${sku.sku}</p>
            ${vendorChangesHTML}
            <hr>
        `;
    }).join('');

    Swal.fire({
        title: 'Confirm Changes',
        html: changesHTML,
        icon: 'info',
        showCancelButton: true,
        confirmButtonText: 'Yes, save it!',
        cancelButtonText: 'No, cancel!'
    }).then((result) => {
        if (result.isConfirmed) {
            saveVendorMappings();
        }
    });
}


function saveVendorMappings() {
    console.log('Saving Vendor Mappings...');
    const mappings = skuVendorMappingData.map(sku => ({
        sku: sku.sku,
        V1: sku.vendor1,
        V2: sku.vendor2,
        V3: sku.vendor3,
        V4: sku.vendor4,
        V5: sku.vendor5
    }));

    document.getElementById('saveVendorMappingButton').disabled = true;
    Swal.fire({
        title: 'Saving...',
        text: 'Please wait while we save your changes.',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    google.script.run.withSuccessHandler(response => {
        console.log('Vendor Mappings Saved:', response);
        Swal.fire({ icon: 'success', title: 'Success!', text: 'Vendor mappings saved successfully.', timer: 1500 });
        document.getElementById('saveVendorMappingButton').disabled = false;
        loadSKUsForVendorMapping();
    }).withFailureHandler(error => {
        console.error('Failed to save Vendor Mappings:', error);
        Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to save vendor mappings: ' + error.message });
        document.getElementById('saveVendorMappingButton').disabled = false;
    }).saveVendorMappings(mappings);
}

document.addEventListener('DOMContentLoaded', () => {
    // Existing DOMContentLoaded code...
    
    // Load SKUs for Vendor Mapping on page load
    loadSKUsForVendorMapping();

    // Event listener for vendor selects
    document.addEventListener('change', function(event) {
        if (event.target.classList.contains('vendor-select')) {
            const sku = event.target.getAttribute('data-sku');
            const vendorKey = event.target.getAttribute('data-vendor');
            const newValue = event.target.value;

            skuVendorMappingData.forEach(skuObj => {
                if (skuObj.sku === sku) {
                    skuObj[vendorKey === 'V1' ? 'vendor1' : vendorKey === 'V2' ? 'vendor2' : vendorKey === 'V3' ? 'vendor3' : vendorKey === 'V4' ? 'vendor4' : 'vendor5'] = newValue;
                }
            });
        }
    });
});
</script>

<!--************** MODALS ************* -->
<div id="addSKUModal" class="fixed inset-0 bg-gray-900/80 backdrop-blur-md items-center justify-center z-50 modal-container hidden">
  <div class="bg-white rounded-2xl shadow-2xl w-11/12 md:w-10/12 lg:w-9/12 xl:w-3/4 max-w-6xl transform transition-all duration-300 scale-100 opacity-100">
    <!-- Modal header with improved gradient background -->
    <div class="bg-gradient-to-r from-blue-500 via-indigo-400 to-purple-700 rounded-t-2xl p-2 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="bg-white/20 p-2 rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </div>
        <h2 class="text-xl md:text-2xl font-bold text-white tracking-wide">
          Add New SKU
        </h2>
      </div>
    </div>
    
    <!-- Modal body with improved design -->
    <div class="p-6 bg-gray-50">
      <form id="addSKUForm" class="overflow-y-auto max-h-[68vh] pr-1">
        <!-- Form sections with improved styling -->
        <div class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h3 class="text-gray-800 font-semibold text-lg mb-4 flex items-center">
            <div class="bg-blue-100 text-blue-600 p-1.5 rounded-md mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            Basic Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Item Name</label>
              <input type="text" name="itemName" placeholder="Enter item name" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white" required>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">SKU</label>
              <input type="text" name="sku" placeholder="Enter SKU code" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white" required>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">UOM</label>
              <input type="text" name="uom" placeholder="Unit of Measure" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 bg-white" required>
            </div>
          </div>
        </div>
        
        <div class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h3 class="text-gray-800 font-semibold text-lg mb-4 flex items-center">
            <div class="bg-green-100 text-green-600 p-1.5 rounded-md mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            </div>
            Inventory Settings
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Min Level</label>
              <input type="number" name="minLvl" placeholder="0" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 bg-white" required>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Max Level</label>
              <input type="number" name="maxLvl" placeholder="100" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 bg-white" required>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Reorder Qty</label>
              <input type="number" name="reorderQty" placeholder="25" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 bg-white" required>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Opening Stock</label>
              <input type="number" name="openingStock" placeholder="50" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 bg-white" required>
            </div>
          </div>
        </div>
        
        <div class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h3 class="text-gray-800 font-semibold text-lg mb-4 flex items-center">
            <div class="bg-indigo-100 text-indigo-600 p-1.5 rounded-md mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
            Location
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Warehouse</label>
              <div class="relative">
                <input list="warehouses" name="warehouse" placeholder="Select warehouse" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 bg-white" required>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
                <datalist id="warehouses">
                  <!-- Options will be populated dynamically -->
                </datalist>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Location</label>
              <div class="relative">
                <input type="text" name="location" placeholder="type location" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 bg-white" required>
                <datalist id="locations">
                  <!-- Options will be populated dynamically -->
                </datalist>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h3 class="text-gray-800 font-semibold text-lg mb-4 flex items-center">
            <div class="bg-amber-100 text-amber-600 p-1.5 rounded-md mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            Financial Details
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Price</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <span class="text-gray-500 font-medium"></span>
                </div>
                <input type="number" name="price" step="0.01" placeholder="0.00" class="w-full border border-gray-300 rounded-lg pl-8 pr-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition duration-200 bg-white" required>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mb-6 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
          <h3 class="text-gray-800 font-semibold text-lg mb-4 flex items-center">
            <div class="bg-purple-100 text-purple-600 p-1.5 rounded-md mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
            Vendor Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Primary Vendor</label>
              <div class="relative">
                <input list="vendors" name="vendor1" placeholder="Primary vendor" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 bg-white">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
                <datalist id="vendors">
                  <!-- Options will be populated dynamically -->
                </datalist>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Secondary Vendor</label>
              <div class="relative">
                <input list="vendors" name="vendor2" placeholder="Secondary vendor" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 bg-white">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Tertiary Vendor</label>
              <div class="relative">
                <input list="vendors" name="vendor3" placeholder="Tertiary vendor" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 bg-white">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Alternative Vendor 1</label>
              <div class="relative">
                <input list="vendors" name="vendor4" placeholder="Alternative vendor 1" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 bg-white">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">Alternative Vendor 2</label>
              <div class="relative">
                <input list="vendors" name="vendor5" placeholder="Alternative vendor 2" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition duration-200 bg-white">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal footer with improved buttons -->
        <div class="pt-5 border-t border-gray-200 flex flex-col sm:flex-row justify-center sm:justify-end space-y-3 sm:space-y-0 sm:space-x-4">
          <button type="button" onclick="closeModal('addSKUModal')" class="px-6 py-3 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300 transition duration-200 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            Cancel
          </button>
         <button type="submit" class="px-6 py-3 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-blue-700 hover:via-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200 shadow-md flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Add SKU
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="editSKUModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('editSKUModal')">&times;</span>
    <h2>Edit SKU</h2>
    <form id="editSKUForm" class="form-horizontal">
      <input type="hidden" id="editSKUId" name="id">
      <div class="form-group">
        <label>Item Name:</label>
        <input type="text" id="editItemName" name="itemName" readonly>
      </div>
      <div class="form-group">
        <label>SKU:</label>
        <input type="text" id="editSKU" name="sku" readonly>
      </div>
      <div class="form-group">
        <label>UOM:</label>
        <input type="text" id="editUom" name="uom" required>
      </div>
      <div class="form-group">
        <label>Min Level:</label>
        <input type="number" id="editMinLvl" name="minLvl" required>
      </div>
      <div class="form-group">
        <label>Max Level:</label>
        <input type="number" id="editMaxLvl" name="maxLvl" required>
      </div>
      <div class="form-group">
        <label>Reorder Qty:</label>
        <input type="number" id="editReorderQty" name="reorderQty" required>
      </div>
      <div class="form-group">
        <label>Warehouse:</label>
        <select id="editWarehouse" name="warehouse" class="select2" required></select>
      </div>
      <div class="form-group">
        <label>Location:</label>
        <select id="editLocation" name="location" class="select2" required></select>
      </div>
      <div class="form-group">
        <label>Opening Stock:</label>
        <input type="number" id="editOpeningStock" name="openingStock" readonly>
      </div>
      <div class="form-group">
        <label>Price:</label>
        <input type="number" id="editPrice" name="price" step="0.01" required>
      </div>
      <div class="form-group">
        <label>Vendor 1:</label>
        <select id="editVendor1" name="vendor1" class="select2"></select>
      </div>
      <div class="form-group">
        <label>Vendor 2:</label>
        <select id="editVendor2" name="vendor2" class="select2"></select>
      </div>
      <div class="form-group">
        <label>Vendor 3:</label>
        <select id="editVendor3" name="vendor3" class="select2"></select>
      </div>
      <div class="form-group">
        <label>Vendor 4:</label>
        <select id="editVendor4" name="vendor4" class="select2"></select>
      </div>
      <div class="form-group">
        <label>Vendor 5:</label>
        <select id="editVendor5" name="vendor5" class="select2"></select>
      </div>
      <button type="submit" class="btn btn-primary">Update SKU</button>
    </form>
  </div>
</div>
     <div id="addSupplierModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 modal-container">
  <div class="bg-white rounded-xl shadow-xl w-11/12 md:w-10/12 lg:w-9/12 xl:w-3/4 py-8 px-6 mx-auto">
    <span class="absolute top-4 right-4 text-gray-600 cursor-pointer" onclick="closeModal('addSupplierModal')">&times;</span>
    <h2 class="text-xl font-bold mb-4 text-center text-indigo-700">
      Add Supplier
    </h2>
    <form id="addSupplierForm" class="overflow-y-auto" style="max-height: 400px;">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
        <div>
          <label class="font-semibold text-gray-700">Supplier Name:</label>
          <input type="text" name="vendorName" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">Contact Person Name:</label>
          <input type="text" name="contactPersonName" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">Contact Number:</label>
          <input type="text" name="contactNumber" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">Address Line 1:</label>
          <input type="text" name="addressLine1" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">Address Line 2:</label>
          <input type="text" name="addressLine2" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition">
        </div>
        <div>
          <label class="font-semibold text-gray-700">Address Line 3:</label>
          <input type="text" name="addressLine3" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition">
        </div>
        <div>
          <label class="font-semibold text-gray-700">City:</label>
          <input type="text" name="city" id="city" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" readonly>
        </div>
        <div>
          <label class="font-semibold text-gray-700">State:</label>
          <input type="text" name="state" id="state" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" readonly>
        </div>
        <div>
          <label class="font-semibold text-gray-700">PIN Code:</label>
          <input type="text" name="pinCode" id="pinCode" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required oninput="fetchPincodeDetails()">
        </div>
        <div>
          <label class="font-semibold text-gray-700">GST No.:</label>
          <input type="text" name="gstNo" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">Email ID:</label>
          <input type="email" name="emailId" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
        <div>
          <label class="font-semibold text-gray-700">WhatsApp No.:</label>
          <input type="text" name="whatsappNo" class="w-full border border-gray-300 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" required>
        </div>
      </div>
      <div class="text-center mt-6">
        <button type="submit" class="bg-indigo-600 text-white px-5 py-2 rounded-xl hover:bg-indigo-700 transition duration-200">
          Add Supplier
        </button>
        <button type="button" class="bg-gray-500 text-white px-5 py-2 rounded-xl hover:bg-gray-600 transition duration-200 ml-2" onclick="closeModal('addSupplierModal')">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

     <div id="editSupplierModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('editSupplierModal')">&times;</span>
    <h2>Edit Supplier</h2>
    <form id="editSupplierForm">
      <div class="form-group">
        <label>Supplier ID:</label>
        <input type="text" id="editSupplierId" name="id" readonly> <!-- Read-only Supplier ID -->
      </div>
      <div class="form-group">
        <label>Supplier Name:</label>
        <input type="text" id="editVendorName" name="vendorName" required>
      </div>
      <div class="form-group">
        <label>Contact Person Name:</label>
        <input type="text" id="editContactPersonName" name="contactPersonName" required>
      </div>
      <div class="form-group">
        <label>Contact Number:</label>
        <input type="text" id="editContactNumber" name="contactNumber" required>
      </div>
      <div class="form-group">
        <label>Address Line 1:</label>
        <input type="text" id="editAddressLine1" name="addressLine1" required>
      </div>
      <div class="form-group">
        <label>Address Line 2:</label>
        <input type="text" id="editAddressLine2" name="addressLine2">
      </div>
      <div class="form-group">
        <label>Address Line 3:</label>
        <input type="text" id="editAddressLine3" name="addressLine3">
      </div>
      <div class="form-group">
        <label>City:</label>
        <input type="text" id="editCity" name="city" required readonly>
      </div>
      <div class="form-group">
        <label>State:</label>
        <input type="text" id="editState" name="state" required readonly>
      </div>
      <div class="form-group">
        <label>PIN Code:</label>
        <input type="text" id="editPinCode" name="pinCode" required oninput="fetchPincodeDetailsForEdit()">
      </div>
      <div class="form-group">
        <label>GST No.:</label>
        <input type="text" id="editGstNo" name="gstNo" required>
      </div>
      <div class="form-group">
        <label>Email ID:</label>
        <input type="email" id="editEmailId" name="emailId" required>
      </div>
      <div class="form-group">
        <label>WhatsApp No.:</label>
        <input type="text" id="editWhatsAppNo" name="whatsappNo" required>
      </div>
      <button type="submit" class="btn btn-primary">Update Supplier</button>
    </form>
  </div>
</div>
<div id="addWarehouseModal" class="modal">
          <div class="modal-content">
              <span class="close"></span>
              <h2>Add Warehouse</h2>
              <form id="addWarehouseForm">
                  <div class="form-group"><label>Supplier Name:</label><input type="text" name="vendorName" required></div>
                  <div class="form-group"><label>Location:</label><input type="text" name="location" required></div>
                  <div class="form-group"><label>Manager Name:</label><input type="text" name="managerName" required></div>
                  <button type="submit" class="btn btn-primary">Add Warehouse</button>
              </form>
          </div>
</div>

<div id="editWarehouseModal" class="modal">
          <div class="modal-content">
              <span class="close"></span>
              <h2>Edit Warehouse</h2>
              <form id="editWarehouseForm">
                  <input type="hidden" id="editWarehouseId" name="id">
                  <div class="form-group"><label>Supplier Name:</label><input type="text" id="editWarehouseVendorName" name="vendorName" required></div>
                  <div class="form-group"><label>Location:</label><input type="text" id="editWarehouseLocation" name="location" required></div>
                  <div class="form-group"><label>Manager Name:</label><input type="text" id="editWarehouseManagerName" name="managerName" required></div>
                  <button type="submit" class="btn btn-primary">Update Warehouse</button>
              </form>
          </div>
</div>

<div id="addAdjustmentModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('addAdjustmentModal')">&times;</span>
    <h2>Add Stock Adjustment</h2>
    <form id="addAdjustmentForm">
      <div class="form-group">
        <label>Item Name:</label>
        <input list="itemNames" name="itemName" id="adjustmentItemName" required>
        <datalist id="itemNames">
          <!-- Options will be populated dynamically -->
        </datalist>
      </div>
      <div class="form-group">
        <label>SKU:</label>
        <input list="skus" name="sku" id="adjustmentSKU" required>
        <datalist id="skus">
          <!-- Options will be populated dynamically -->
        </datalist>
      </div>
      <div class="form-group">
        <label>Quantity:</label>
        <input type="number" name="qty" id="adjustmentQty" required>
      </div>
      <div class="form-group">
        <label>Adjustment Type:</label>
        <select name="type" id="adjustmentType" class="select2" required>
          <option value="">Select Type</option>
          <option value="in">Stock In</option>
          <option value="out">Stock Out</option>
        </select>
      </div>
      <div class="form-group">
        <label>Remarks:</label>
        <input name="remarks" id="adjustmentRemarks" ></input>
      </div>
      <button type="submit" class="btn btn-primary">Add Adjustment</button>
    </form>
  </div>
</div>

<div id="addLocationModal" class="modal">
          <div class="modal-content">
              <span class="close"></span>
              <h2>Add Location</h2>
              <form id="addLocationForm">
                  <div class="form-group"><label>Location ID (if any):</label><input type="text" name="locationId"></div>
                  <div class="form-group"><label>Location*:</label><input type="text" name="location" required></div>
                  <div class="form-group"><label>Location Handler (if any):</label><input type="text" name="locationHandler"></div>
                  <button type="submit" class="btn btn-primary">Add Location</button>
              </form>
          </div>
</div>

<div id="skuImportModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('skuImportModal')"></span>
      <h2>Import SKUs</h2><br>
      <p>Download the template, fill it, and upload it below.</p>
      <button class="btn btn-secondary" onclick="downloadSKUTemplate()">Download CSV Template</button>
      <input type="file" id="skuCSVInput" accept=".csv" style="margin: 10px 0;">
      <button class="btn btn-primary" onclick="uploadSKUCSV()">Submit</button>
    </div>
</div>


<div id="transactionImportModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeModal('transactionImportModal')"></span>
      <h2>Import Transactions</h2> <br>
      <p>Download the template, fill it, and upload it below.</p>
      <button class="btn btn-secondary" onclick="downloadTransactionTemplate()">Download CSV Template</button>
      <input type="file" id="transactionCSVInput" accept=".csv" style="margin: 10px 0;">
      <button class="btn btn-primary" onclick="uploadTransactionCSV()">Submit</button>
    </div>
</div>

</body>
</html>
